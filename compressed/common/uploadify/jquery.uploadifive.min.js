"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(p){var r={init:function(n){return this.each(function(){var l=p(this);l.data("uploadifive",{inputs:{},inputCount:0,fileID:0,queue:{count:0,selected:0,replaced:0,errors:0,queued:0,cancelled:0},uploads:{current:0,attempts:0,successful:0,errors:0,count:0}});var a=l.data("uploadifive"),s=a.settings=p.extend({auto:!0,buttonClass:!1,buttonText:"Select Files",checkScript:!1,dnd:!0,dropTarget:!1,fileObjName:"Filedata",fileSizeLimit:0,fileType:!1,formData:{},height:30,itemTemplate:!1,method:"post",multi:!0,overrideEvents:[],queueID:!1,queueSizeLimit:0,removeCompleted:!1,simUploadLimit:0,truncateLength:0,uploadLimit:0,uploadScript:"uploadifive.php",width:100},n);if(isNaN(s.fileSizeLimit)){var e=1.024*parseInt(s.fileSizeLimit);-1<s.fileSizeLimit.indexOf("KB")?s.fileSizeLimit=1e3*e:-1<s.fileSizeLimit.indexOf("MB")?s.fileSizeLimit=1e6*e:-1<s.fileSizeLimit.indexOf("GB")&&(s.fileSizeLimit=1e9*e)}else s.fileSizeLimit=1024*s.fileSizeLimit;if(a.inputTemplate=p('<input type="file">').css({"font-size":s.height+"px",opacity:0,position:"absolute",right:"-3px",top:"-3px","z-index":999}),a.createInput=function(){var e=a.inputTemplate.clone(),i=e.name="input"+a.inputCount++;s.multi&&e.attr("multiple",!0),s.fileType&&e.attr("accept",s.fileType),e.bind("change",function(){a.queue.selected=0,a.queue.replaced=0,a.queue.errors=0,a.queue.queued=0;var e=this.files.length;if(a.queue.selected=e,a.queue.count+e>s.queueSizeLimit&&0!==s.queueSizeLimit)p.inArray("onError",s.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+s.queueSizeLimit+").  Please select fewer files."),"function"==typeof s.onError&&s.onError.call(l,"QUEUE_LIMIT_EXCEEDED");else{for(var t=0;t<e;t++)file=this.files[t],a.addQueueItem(file);a.inputs[i]=this,a.createInput()}s.auto&&r.upload.call(l),"function"==typeof s.onSelect&&s.onSelect.call(l,a.queue)}),a.currentInput&&a.currentInput.hide(),a.button.append(e),a.currentInput=e},a.destroyInput=function(e){p(a.inputs[e]).remove(),delete a.inputs[e],a.inputCount--},a.drop=function(e){a.queue.selected=0,a.queue.replaced=0,a.queue.errors=0,a.queue.queued=0;var t=e.dataTransfer,i=t.name="input"+a.inputCount++,n=t.files.length;if(a.queue.selected=n,a.queue.count+n>s.queueSizeLimit&&0!==s.queueSizeLimit)p.inArray("onError",s.overrideEvents)<0&&alert("The maximum number of queue items has been reached ("+s.queueSizeLimit+").  Please select fewer files."),"function"==typeof s.onError&&s.onError.call(l,"QUEUE_LIMIT_EXCEEDED");else{for(var o=0;o<n;o++)file=t.files[o],a.addQueueItem(file);a.inputs[i]=t}s.auto&&r.upload.call(l),"function"==typeof s.onDrop&&s.onDrop.call(l,t.files,t.files.length),e.preventDefault(),e.stopPropagation()},a.fileExistsInQueue=function(e){for(var t in a.inputs){input=a.inputs[t],limit=input.files.length;for(var i=0;i<limit;i++)if(existingFile=input.files[i],existingFile.name==e.name&&!existingFile.complete)return!0}return!1},a.removeExistingFile=function(e){for(var t in a.inputs){input=a.inputs[t],limit=input.files.length;for(var i=0;i<limit;i++)existingFile=input.files[i],existingFile.name!=e.name||existingFile.complete||(a.queue.replaced++,r.cancel.call(l,existingFile,!0))}},0==s.itemTemplate?a.queueItem=p('<div class="uploadifive-queue-item">                        <a class="close" href="#">X</a>                        <div><span class="filename"></span><span class="fileinfo"></span></div>                        <div class="progress">                            <div class="progress-bar"></div>                        </div>                    </div>'):a.queueItem=p(s.itemTemplate),a.addQueueItem=function(e){if(p.inArray("onAddQueueItem",s.overrideEvents)<0){a.removeExistingFile(e),e.queueItem=a.queueItem.clone(),e.queueItem.attr("id",s.id+"-file-"+a.fileID++),e.queueItem.find(".close").bind("click",function(){return r.cancel.call(l,e),!1});var t=e.name;t.length>s.truncateLength&&0!=s.truncateLength&&(t=t.substring(0,s.truncateLength)+"..."),e.queueItem.find(".filename").html(t),e.queueItem.data("file",e),a.queueEl.append(e.queueItem)}"function"==typeof s.onAddQueueItem&&s.onAddQueueItem.call(l,e),e.size>s.fileSizeLimit&&0!=s.fileSizeLimit?a.error("FILE_SIZE_LIMIT_EXCEEDED",e):(a.queue.queued++,a.queue.count++)},a.removeQueueItem=function(e,t,i){i||(i=0);var n=t?0:500;e.queueItem&&(" - Completed"!=e.queueItem.find(".fileinfo").html()&&e.queueItem.find(".fileinfo").html(" - Cancelled"),e.queueItem.find(".progress-bar").width(0),e.queueItem.delay(i).fadeOut(n,function(){p(this).remove()}),delete e.queueItem,a.queue.count--)},a.filesToUpload=function(){var e=0;for(var t in a.inputs){input=a.inputs[t],limit=input.files.length;for(var i=0;i<limit;i++)file=input.files[i],file.skip||file.complete||e++}return e},a.checkExists=function(t){if(p.inArray("onCheck",s.overrideEvents)<0){p.ajaxSetup({async:!1});var e=p.extend(s.formData,{filename:t.name});if(p.post(s.checkScript,e,function(e){t.exists=parseInt(e)}),t.exists&&!confirm("A file named "+t.name+" already exists in the upload folder.\nWould you like to replace it?"))return r.cancel.call(l,t),!0}return"function"==typeof s.onCheck&&s.onCheck.call(l,t,t.exists),!1},a.uploadFile=function(r,u){if(!r.skip&&!r.complete&&!r.uploading)if(r.uploading=!0,a.uploads.current++,a.uploads.attempted++,xhr=r.xhr=new XMLHttpRequest,"function"==typeof FormData||"object"===("undefined"==typeof FormData?"undefined":_typeof(FormData))){var e=new FormData;for(i in e.append(s.fileObjName,r),s.formData)e.append(i,s.formData[i]);xhr.open(s.method,s.uploadScript,!0),xhr.upload.addEventListener("progress",function(e){e.lengthComputable&&a.progress(e,r)},!1),xhr.addEventListener("load",function(e){4==this.readyState&&(r.uploading=!1,200==this.status?"Invalid file type."!==r.xhr.responseText?a.uploadComplete(e,r,u):a.error(r.xhr.responseText,r,u):404==this.status?a.error("404_FILE_NOT_FOUND",r,u):403==this.status?a.error("403_FORBIDDEN",r,u):a.error("Unknown Error",r,u))}),xhr.send(e)}else{var t=new FileReader;t.onload=function(e){var t="-------------------------"+(new Date).getTime(),i="--",n="\r\n",o="";for(key in o+=i+t+n,o+='Content-Disposition: form-data; name="'+s.fileObjName+'"',r.name&&(o+='; filename="'+r.name+'"'),o+=n,o+="Content-Type: application/octet-stream"+n+n,o+=e.target.result+n,s.formData)o+=i+t+n,o+='Content-Disposition: form-data; name="'+key+'"'+n+n,o+=s.formData[key]+n;o+=i+t+i+n,xhr.upload.addEventListener("progress",function(e){a.progress(e,r)},!1),xhr.addEventListener("load",function(e){r.uploading=!1,404==this.status?a.error("404_FILE_NOT_FOUND",r,u):"Invalid file type."!=r.xhr.responseText?a.uploadComplete(e,r,u):a.error(r.xhr.responseText,r,u)},!1);s.uploadScript;"get"==s.method&&p(s.formData).param();xhr.open(s.method,s.uploadScript,!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+t),"function"==typeof s.onUploadFile&&s.onUploadFile.call(l,r),xhr.sendAsBinary(o)},t.readAsBinaryString(r)}},a.progress=function(e,t){if(p.inArray("onProgress",s.overrideEvents)<0){if(e.lengthComputable)var i=Math.round(e.loaded/e.total*100);t.queueItem.find(".fileinfo").html(" - "+i+"%"),t.queueItem.find(".progress-bar").css("width",i+"%")}"function"==typeof s.onProgress&&s.onProgress.call(l,t,e)},a.error=function(e,t,i){if(p.inArray("onError",s.overrideEvents)<0){switch(e){case"404_FILE_NOT_FOUND":errorMsg="404 Error";break;case"403_FORBIDDEN":errorMsg="403 Forbidden";break;case"FORBIDDEN_FILE_TYPE":errorMsg="Forbidden File Type";break;case"FILE_SIZE_LIMIT_EXCEEDED":errorMsg="File Too Large";break;default:errorMsg="Unknown Error"}t.queueItem.addClass("error").find(".fileinfo").html(" - "+errorMsg),t.queueItem.find(".progress").remove()}"function"==typeof s.onError&&s.onError.call(l,e,t),t.skip=!0,"404_FILE_NOT_FOUND"==e?a.uploads.errors++:a.queue.errors++,i&&r.upload.call(l,null,!0)},a.uploadComplete=function(e,t,i){p.inArray("onUploadComplete",s.overrideEvents)<0&&(t.queueItem.find(".progress-bar").css("width","100%"),t.queueItem.find(".fileinfo").html(" - Completed"),t.queueItem.find(".progress").slideUp(250),t.queueItem.addClass("complete")),"function"==typeof s.onUploadComplete&&s.onUploadComplete.call(l,t,t.xhr.responseText),s.removeCompleted&&setTimeout(function(){r.cancel.call(l,t)},3e3),t.complete=!0,a.uploads.successful++,a.uploads.count++,a.uploads.current--,delete t.xhr,i&&r.upload.call(l,null,!0)},a.queueComplete=function(){"function"==typeof s.onQueueComplete&&s.onQueueComplete.call(l,a.uploads)},!(window.File&&window.FileList&&window.Blob&&(window.FileReader||window.FormData)))return"function"==typeof s.onFallback&&s.onFallback.call(l),!1;if(s.id="uploadifive-"+l.attr("id"),a.button=p('<div id="'+s.id+'" class="uploadifive-button">'+s.buttonText+"</div>"),s.buttonClass&&a.button.addClass(s.buttonClass),a.button.css({height:s.height,"line-height":s.height+"px",overflow:"hidden",position:"relative","text-align":"center",width:s.width}),l.before(a.button).appendTo(a.button).hide(),a.createInput.call(l),s.queueID?a.queueEl=p("#"+s.queueID):(s.queueID=s.id+"-queue",a.queueEl=p('<div id="'+s.queueID+'" class="uploadifive-queue" />'),a.button.after(a.queueEl)),s.dnd){var t=s.dropTarget?p(s.dropTarget):a.queueEl.get(0);t.addEventListener("dragleave",function(e){e.preventDefault(),e.stopPropagation()},!1),t.addEventListener("dragenter",function(e){e.preventDefault(),e.stopPropagation()},!1),t.addEventListener("dragover",function(e){e.preventDefault(),e.stopPropagation()},!1),t.addEventListener("drop",a.drop,!1)}XMLHttpRequest.prototype.sendAsBinary||(XMLHttpRequest.prototype.sendAsBinary=function(e){var t=Array.prototype.map.call(e,function(e){return 255&e.charCodeAt(0)}),i=new Uint8Array(t);this.send(i.buffer)}),"function"==typeof s.onInit&&s.onInit.call(l)})},debug:function(){return this.each(function(){console.log(p(this).data("uploadifive"))})},clearQueue:function(){this.each(function(){var e=p(this),t=e.data("uploadifive"),n=t.settings;for(var o in t.inputs)for(input=t.inputs[o],limit=input.files.length,i=0;i<limit;i++)file=input.files[i],r.cancel.call(e,file);"function"==typeof n.onClearQueue&&n.onClearQueue.call(e,p("#"+t.settings.queueID))})},cancel:function(n,o){this.each(function(){var e=p(this),t=e.data("uploadifive"),i=t.settings;"string"==typeof n&&(isNaN(n)||(fileID="uploadifive-"+p(this).attr("id")+"-file-"+n),n=p("#"+fileID).data("file")),n.skip=!0,t.filesCancelled++,n.uploading&&(t.uploads.current--,n.uploading=!1,n.xhr.abort(),delete n.xhr,r.upload.call(e)),p.inArray("onCancel",i.overrideEvents)<0&&t.removeQueueItem(n,o),"function"==typeof i.onCancel&&i.onCancel.call(e,n)})},upload:function(o,r){this.each(function(){var e=p(this),t=e.data("uploadifive"),i=t.settings;if(o)t.uploadFile.call(e,o);else if(t.uploads.count+t.uploads.current<i.uploadLimit||0==i.uploadLimit){if(!r){t.uploads.attempted=0,t.uploads.successsful=0,t.uploads.errors=0;var n=t.filesToUpload();"function"==typeof i.onUpload&&i.onUpload.call(e,n)}p("#"+i.queueID).find(".uploadifive-queue-item").not(".error, .complete").each(function(){if(_file=p(this).data("file"),t.uploads.current>=i.simUploadLimit&&0!==i.simUploadLimit||t.uploads.current>=i.uploadLimit&&0!==i.uploadLimit||t.uploads.count>=i.uploadLimit&&0!==i.uploadLimit)return!1;i.checkScript?(_file.checking=!0,skipFile=t.checkExists(_file),_file.checking=!1,skipFile||t.uploadFile(_file,!0)):t.uploadFile(_file,!0)}),0==p("#"+i.queueID).find(".uploadifive-queue-item").not(".error, .complete").size()&&t.queueComplete()}else 0==t.uploads.current&&(p.inArray("onError",i.overrideEvents)<0&&0<t.filesToUpload()&&0!=i.uploadLimit&&alert("The maximum upload limit has been reached."),"function"==typeof i.onError&&i.onError.call(e,"UPLOAD_LIMIT_EXCEEDED",t.filesToUpload()))})},destroy:function(){this.each(function(){var e=p(this),t=e.data("uploadifive"),i=t.settings;r.clearQueue.call(e),i.queueID||p("#"+i.queueID).remove(),e.siblings("input").remove(),e.show().insertBefore(t.button),t.button.remove(),"function"==typeof i.onDestroy&&i.onDestroy.call(e)})}};p.fn.uploadifive=function(e){return r[e]?r[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==(void 0===e?"undefined":_typeof(e))&&e?void p.error("The method "+e+" does not exist in $.uploadify"):r.init.apply(this,arguments)}}(jQuery);