"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(global){function createCookie(e,t,r){var o=new Date;o.setTime(o.getTime()+24*r*60*60*1e3);var n="; expires="+o.toGMTString();document.cookie=e+"="+t+n+"; path=/"}function readCookie(e){for(var t=e+"=",r=document.cookie.split(";"),o=0,n=r.length;o<n;o++){for(var i=r[o];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(t))return i.substring(t.length,i.length)}return null}function QiniuJsSDK(){var moxie=require("./plupload/moxie");window.moxie=moxie;var plupload=require("./plupload/plupload.dev");window.plupload=plupload;var that=this;this.detectIEVersion=function(){for(var e=4,t=document.createElement("div"),r=t.getElementsByTagName("i");t.innerHTML="\x3c!--[if gt IE "+e+"]><i></i><![endif]--\x3e",r[0];)e++;return 4<e&&e};var logger={MUTE:0,FATA:1,ERROR:2,WARN:3,INFO:4,DEBUG:5,TRACE:6,level:0},qiniuUploadUrl;function log(e,t){for(var r="[qiniu-js-sdk]["+e+"]",o=r,n=0;n<t.length;n++)"string"==typeof t[n]?o+=" "+t[n]:o+=" "+that.stringifyJSON(t[n]);that.detectIEVersion()?console.log(o):(t.unshift(r),console.log.apply(console,t)),document.getElementById("qiniu-js-sdk-log")&&(document.getElementById("qiniu-js-sdk-log").innerHTML+="<p>"+o+"</p>")}function makeLogFunc(t){var r=t.toLowerCase();logger[r]=function(){if(window.console&&window.console.log&&logger.level>=logger[t]){var e=Array.prototype.slice.call(arguments);log(r,e)}}}for(var property in logger)logger.hasOwnProperty(property)&&"number"==typeof logger[property]&&!logger.hasOwnProperty(property.toLowerCase())&&makeLogFunc(property);qiniuUploadUrl="https:"===window.location.protocol?"https://upload.qiniup.com":"http://upload.qiniup.com";var qiniuUploadUrls=["http://upload.qiniup.com","http://up.qiniup.com"],qiniuUpHosts={http:["http://upload.qiniup.com","http://up.qiniup.com"],https:["https://upload.qiniup.com"]},changeUrlTimes=0;function StatisticsLogger(){var r="https://uplog.qbox.me/log/3",g=[],p={waiting:0,processing:1,finished:2};function o(e){e.status=p.processing;var t=that.createAjax();t.open("POST",r,!0),t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.setRequestHeader("Authorization","UpToken "+that.token),t.onreadystatechange=function(){4===t.readyState&&(200===t.status?(logger.debug("[STATISTICS] successfully report log to server"),e.status=p.finished):(logger.debug("[STATISTICS] report log to server failed"),e.status=p.waiting))},t.send(e.log)}this.log=function(e,t,r,o,n,i,a,s,u,l){var d=Array.prototype.join.call(arguments,",");g.push({log:d,status:p.waiting}),logger.debug("[STATISTICS] send log to statistics server",d)},setInterval(function(){for(var e=[],t=0;t<g.length;t++)g[t].status!==p.finished&&e.push(g[t]),g[t].status===p.waiting&&o(g[t]);g=e},1e3)}var statisticsLogger=new StatisticsLogger,ExtraErrors={ZeroSizeFile:-6,InvalidToken:-5,InvalidArgument:-4,InvalidFile:-3,Cancelled:-2,NetworkError:-1,UnknownError:0,TimedOut:-1001,UnknownHost:-1003,CannotConnectToHost:-1004,NetworkConnectionLost:-1005};this.resetUploadUrl=function(e){if(logger.debug("num: "+e),0==e){logger.debug("use main uphost");var t=qiniuUpHosts.main;qiniuUploadUrl="https:"===window.location.protocol?"https://"+t[0]:"http://"+t[0]}else{logger.debug("use backup uphost");t=qiniuUpHosts.backup;qiniuUploadUrl=e%2==0?"https:"===window.location.protocol?"https://"+t[1]:"http://"+t[1]:"https:"===window.location.protocol?"https://"+t[0]:"http://"+t[0]}logger.debug("resetUploadUrl: "+qiniuUploadUrl)},this.isImage=function(e){return e=e.split(/[?#]/)[0],/\.(png|jpg|jpeg|gif|bmp)$/i.test(e)},this.getFileExtension=function(e){var t=e.split(".");return 1===t.length||""===t[0]&&2===t.length?"":t.pop().toLowerCase()},this.utf8_encode=function(e){if(null==e)return"";var t,r,o,n=e+"",i="";t=r=0,o=n.length;for(var a=0;a<o;a++){var s=n.charCodeAt(a),u=null;if(s<128)r++;else if(127<s&&s<2048)u=String.fromCharCode(s>>6|192,63&s|128);else if(63488&s^!0)u=String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128);else{if(64512&s^!0)throw new RangeError("Unmatched trail surrogate at "+a);var l=n.charCodeAt(++a);if(64512&l^!0)throw new RangeError("Unmatched lead surrogate at "+(a-1));s=((1023&s)<<10)+(1023&l)+65536,u=String.fromCharCode(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}null!==u&&(t<r&&(i+=n.slice(t,r)),i+=u,t=r=a+1)}return t<r&&(i+=n.slice(t,o)),i},this.base64_decode=function(e){var t,r,o,n,i,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=0,l=0,d=[];if(!e)return e;for(e+="";t=(a=s.indexOf(e.charAt(u++))<<18|s.indexOf(e.charAt(u++))<<12|(n=s.indexOf(e.charAt(u++)))<<6|(i=s.indexOf(e.charAt(u++))))>>16&255,r=a>>8&255,o=255&a,d[l++]=64===n?String.fromCharCode(t):64===i?String.fromCharCode(t,r):String.fromCharCode(t,r,o),u<e.length;);return d.join("")},this.base64_encode=function(e){var t,r,o,n,i,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=0,u=0,l="",d=[];if(!e)return e;for(e=this.utf8_encode(e+"");t=(i=e.charCodeAt(s++)<<16|e.charCodeAt(s++)<<8|e.charCodeAt(s++))>>18&63,r=i>>12&63,o=i>>6&63,n=63&i,d[u++]=a.charAt(t)+a.charAt(r)+a.charAt(o)+a.charAt(n),s<e.length;);switch(l=d.join(""),e.length%3){case 1:l=l.slice(0,-2)+"==";break;case 2:l=l.slice(0,-1)+"="}return l},this.URLSafeBase64Encode=function(e){return(e=this.base64_encode(e)).replace(/\//g,"_").replace(/\+/g,"-")},this.URLSafeBase64Decode=function(e){return e=e.replace(/_/g,"/").replace(/-/g,"+"),this.base64_decode(e)},this.createAjax=function(e){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},this.parseJSON=function(data){if(window.JSON&&window.JSON.parse)return window.JSON.parse(data);var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,text=String(data);return rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),eval("("+text+")")},this.stringifyJSON=function(e){if(window.JSON&&window.JSON.stringify)return window.JSON.stringify(e);switch(void 0===e?"undefined":_typeof(e)){case"string":return'"'+e.replace(/(["\\])/g,"\\$1")+'"';case"array":return"["+e.map(that.stringifyJSON).join(",")+"]";case"object":if(e instanceof Array){for(var t=[],r=e.length,o=0;o<r;o++)t.push(that.stringifyJSON(e[o]));return"["+t.join(",")+"]"}if(null===e)return"null";var n=[];for(var i in e)e.hasOwnProperty(i)&&n.push(that.stringifyJSON(i)+":"+that.stringifyJSON(e[i]));return"{"+n.join(",")+"}";case"number":case!1:case"boolean":return e}},this.trim=function(e){return null===e?"":e.replace(/^\s+|\s+$/g,"")},this.uploader=function(k){var u=function(e){var t,r,o,n=(t=e.split(":"),r=t[0],(o=that.parseJSON(that.URLSafeBase64Decode(t[2]))).ak=r,0<=o.scope.indexOf(":")?(o.bucket=o.scope.split(":")[0],o.key=o.scope.split(":")[1]):o.bucket=o.scope,o),i=window.location.protocol+"//api.qiniu.com/v2/query?ak="+n.ak+"&bucket="+n.bucket;logger.debug("putPolicy: ",n),logger.debug("get uphosts from: ",i);var a,s=that.detectIEVersion();s&&s<=9?(a=new moxie.xhr.XMLHttpRequest,moxie.core.utils.Env.swf_url=k.flash_swf_url):a=that.createAjax(),a.open("GET",i,!1);var u=function(){if(logger.debug("ajax.readyState: ",a.readyState),4===a.readyState)if(logger.debug("ajax.status: ",a.status),a.status<400){var e=that.parseJSON(a.responseText);qiniuUpHosts.main=e.up.acc.main,qiniuUpHosts.backup=e.up.acc.backup,logger.debug("get new uphosts: ",qiniuUpHosts),that.resetUploadUrl(0)}else logger.error("get uphosts error: ",a.responseText)};s&&s<=9?a.bind("readystatechange",u):a.onreadystatechange=u,a.send()},l=function(e){return!that.token||k.uptoken_url&&that.tokenInfo.isExpired()?d(e):that.token},d=function(e){if(k.uptoken)that.token=k.uptoken;else if(k.uptoken_url){logger.debug("get uptoken from: ",that.uptoken_url);var t=that.createAjax();if(t.open("GET",that.uptoken_url,!1),t.send(),200===t.status){var r=that.parseJSON(t.responseText);that.token=r.uptoken;var o=that.token.split(":"),n=that.parseJSON(that.URLSafeBase64Decode(o[2]));that.tokenMap||(that.tokenMap={});var i=function(e){return Math.ceil(e.getTime()/1e3)},a=i(new Date(t.getResponseHeader("date"))),s=i(new Date);that.tokenInfo={serverDelay:s-a,deadline:n.deadline,isExpired:function(){return this.deadline-i(new Date)+this.serverDelay<600}},logger.debug("get new uptoken: ",that.token),logger.debug("get token info: ",that.tokenInfo)}else logger.error("get uptoken error: ",t.responseText)}else k.uptoken_func?(logger.debug("get uptoken from uptoken_func"),that.token=k.uptoken_func(e),logger.debug("get new uptoken: ",that.token)):logger.error("one of [uptoken, uptoken_url, uptoken_func] settings in options is required!");return that.token&&u(that.token),that.token},b=function(e,t,r){var o="";if(!k.save_key)if(e.getOption&&e.getOption("unique_names")||e.settings&&e.settings.unique_names){var n=that.getFileExtension(t.name);o=n?t.id+"."+n:t.id}else o="function"==typeof r?r(e,t):t.name;return o},_=function(e){if(e&&e.match){var t=e.match(/^https?:\/\/([^:^/]*)/);return t?t[1]:""}return""},w=function(e){if(e&&e.match){var t=e.match(/(^https?)/);if(!t)return"";var r=t[1];return(t=e.match(/^https?:\/\/([^:^/]*):(\d*)/))?t[2]:"http"===r?"80":"443"}return""};if(k.log_level&&(logger.level=k.log_level),!k.domain)throw"domain setting in options is required!";if(!k.browse_button)throw"browse_button setting in options is required!";if(!k.uptoken&&!k.uptoken_url&&!k.uptoken_func)throw"one of [uptoken, uptoken_url, uptoken_func] settings in options is required!";logger.debug("init uploader start"),logger.debug("environment: ",moxie.core.utils.Env),logger.debug("userAgent: ",navigator.userAgent);var e={},t=k.init&&k.init.Error,r=k.init&&k.init.FileUploaded;k.init.Error=function(){},k.init.FileUploaded=function(){},that.uptoken_url=k.uptoken_url,that.token="",that.key_handler="function"==typeof k.init.Key?k.init.Key:"",this.domain=k.domain;var o,n,x="",g={isResumeUpload:!1,resumeFilesize:0,startTime:"",currentTime:""};o=that.detectIEVersion(),n="Safari"===moxie.core.utils.Env.browser&&moxie.core.utils.Env.version<=5&&"Windows"===moxie.core.utils.Env.os&&"7"===moxie.core.utils.Env.osVersion||"Safari"===moxie.core.utils.Env.browser&&"iOS"===moxie.core.utils.Env.os&&"7"===moxie.core.utils.Env.osVersion,o&&o<9&&k.chunk_size&&0<=k.runtimes.indexOf("flash")?k.chunk_size=0:n?k.chunk_size=0:4<<20<plupload.parseSize(k.chunk_size)&&(k.chunk_size=4<<20),logger.debug("invoke reset_chunk_size()"),logger.debug("op.chunk_size: ",k.chunk_size);var i={url:qiniuUploadUrl,multipart_params:{token:""}},a=that.detectIEVersion();a&&a<=9&&(i.multipart_params.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),plupload.extend(e,k,i),logger.debug("option: ",e);var y=new plupload.Uploader(e);logger.debug("new plupload.Uploader(option)"),y.bind("Init",function(e,t){logger.debug("Init event activated"),k.get_new_uptoken||d(null)}),logger.debug("bind Init event"),y.bind("FilesAdded",function(e,t){logger.debug("FilesAdded event activated");var r=e.getOption&&e.getOption("auto_start");r=r||e.settings&&e.settings.auto_start,logger.debug("auto_start: ",r),logger.debug("files: ",t);if("ios"===moxie.core.utils.Env.OS.toLowerCase())for(var o=0;o<t.length;o++){var n=t[o],i=that.getFileExtension(n.name);n.name=n.id+"."+i}r&&setTimeout(function(){e.start(),logger.debug("invoke up.start()")},0),e.refresh()}),logger.debug("bind FilesAdded event"),y.bind("BeforeUpload",function(e,t){logger.debug("BeforeUpload event activated"),t._start_at=new Date,t.speed=t.speed||0,x="",k.get_new_uptoken&&d(t);var r=function(e,t,r){var o;g.startTime=(new Date).getTime(),o=k.save_key?{token:that.token}:{key:b(e,t,r),token:that.token};var n=that.detectIEVersion();n&&n<=9&&(o.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),logger.debug("directUpload multipart_params_obj: ",o);var i=k.x_vars;if(void 0!==i&&"object"===(void 0===i?"undefined":_typeof(i)))for(var a in i)i.hasOwnProperty(a)&&("function"==typeof i[a]?o["x:"+a]=i[a](e,t):"object"!==_typeof(i[a])&&(o["x:"+a]=i[a]));e.setOption({url:qiniuUploadUrl,multipart:!0,chunk_size:s()?k.max_file_size:void 0,multipart_params:o})},s=function(){var e=navigator.userAgent.toLowerCase();return!(!e.match(/MicroMessenger/i)&&"QQBrowser"!==moxie.core.utils.Env.browser&&!e.match(/V1_AND_SQ/i)||"android"!==moxie.core.utils.Env.OS.toLowerCase())},o=e.getOption&&e.getOption("chunk_size");if(o=o||e.settings&&e.settings.chunk_size,logger.debug("uploader.runtime: ",y.runtime),logger.debug("chunk_size: ",o),"html5"!==y.runtime&&"flash"!==y.runtime||!o)logger.debug("directUpload because uploader.runtime !== 'html5' || uploader.runtime !== 'flash' || !chunk_size"),r(e,t,that.key_handler);else if(t.size<o||s())logger.debug("directUpload because file.size < chunk_size || is_android_weixin_or_qq()"),r(e,t,that.key_handler);else{var n=localStorage.getItem(t.name),i=o;if(n){n=that.parseJSON(n);(new Date).getTime()-(n.time||0)<864e5&&100!==n.percent&&t.size===n.total?(t.percent=n.percent,t.loaded=n.offset,x=n.ctx,g.isResumeUpload=!0,g.resumeFilesize=n.offset,n.offset+i>t.size&&(i=t.size-n.offset)):localStorage.removeItem(t.name)}g.startTime=(new Date).getTime();var a={},u=that.detectIEVersion();u&&u<=9&&(a.accept="text/plain; charset=utf-8",logger.debug("add accept text/plain in multipart params")),e.setOption({url:qiniuUploadUrl+"/mkblk/"+i,multipart:!1,chunk_size:o,required_features:"chunks",headers:{Authorization:"UpToken "+l(t)},multipart_params:a})}}),logger.debug("bind BeforeUpload event"),y.bind("UploadProgress",function(e,t){logger.trace("UploadProgress event activated"),g.currentTime=(new Date).getTime();var r=g.currentTime-g.startTime,o=t.loaded||0;g.isResumeUpload&&(o=t.loaded-g.resumeFilesize),t.speed=(o/r*1e3).toFixed(0)||0}),logger.debug("bind UploadProgress event"),y.bind("ChunkUploaded",function(e,t,r){logger.debug("ChunkUploaded event activated"),logger.debug("ChunkUploaded file: ",t),logger.debug("ChunkUploaded info: ",r);var o=that.parseJSON(r.response);logger.debug("ChunkUploaded res: ",o),x=x?x+","+o.ctx:o.ctx;var n=r.total-r.offset,i=e.getOption&&e.getOption("chunk_size");n<(i=i||e.settings&&e.settings.chunk_size)&&(e.setOption({url:qiniuUploadUrl+"/mkblk/"+n}),logger.debug("up.setOption url: ",qiniuUploadUrl+"/mkblk/"+n)),e.setOption({headers:{Authorization:"UpToken "+l(t)}}),localStorage.setItem(t.name,that.stringifyJSON({ctx:x,percent:t.percent,total:r.total,offset:r.offset,time:(new Date).getTime()}))}),logger.debug("bind ChunkUploaded event");var p,S,s=k.max_retries,c=function(e){return 0<s--?(setTimeout(function(){that.resetUploadUrl(s),e.status=plupload.QUEUED,y.stop(),y.start()},0),!0):(s=qiniuUploadUrls.length,!1)};return y.bind("Error",(p=t,function(e,t){logger.error("Error event activated"),logger.error("err: ",t);var r=new Date,o="",n=t.file;if(n){switch(t.code){case plupload.FAILED:o="上传失败。请稍后再试。";break;case plupload.FILE_SIZE_ERROR:var i=e.getOption&&e.getOption("max_file_size");o="浏览器最大可上传"+(i=i||e.settings&&e.settings.max_file_size)+"。更大文件请使用命令行工具。";break;case plupload.FILE_EXTENSION_ERROR:o="文件验证失败。请稍后重试。";break;case plupload.HTTP_ERROR:if(""===t.response){if(o=t.message||"未知网络错误。",!c(n))return;break}var a=that.parseJSON(t.response),s=a.error;switch(t.status){case 400:o="请求报文格式错误。";break;case 401:o="客户端认证授权失败。请重试或提交反馈。";break;case 405:o="客户端请求错误。请重试或提交反馈。";break;case 579:o="资源上传成功，但回调失败。";break;case 599:if(o="网络连接异常。请重试或提交反馈。",!c(n))return;break;case 614:o="文件已存在。";try{s=(a=that.parseJSON(a.error)).error||"file exists"}catch(e){s=a.error||"file exists"}break;case 631:o="指定空间不存在。";break;case 701:o="上传数据块校验出错。请重试或提交反馈。";break;default:if(o="未知错误。",!c(n))return}o=o+"("+t.status+"："+s+")";break;case plupload.SECURITY_ERROR:o="安全配置错误。请联系网站管理员。";break;case plupload.GENERIC_ERROR:case plupload.IO_ERROR:o="上传失败。请稍后再试。";break;case plupload.INIT_ERROR:o="网站配置错误。请联系网站管理员。",y.destroy();break;default:if(o=t.message+t.details,!c(n))return}p&&p(e,t,o)}if(e.refresh(),!k.disable_statistics_report){var u=t&&t.responseHeaders&&t.responseHeaders.match?t.responseHeaders.match(/(X-Reqid\:\ )([\w\.\%-]*)/):[];console.log(t);var l=u[2].replace(/[\r\n]/g,""),d=plupload.HTTP_ERROR?t.status:t.code,g=n._start_at?n._start_at.getTime():r.getTime();statisticsLogger.log(0===d?ExtraErrors.NetworkError:d,l,_(e.settings.url),void 0,w(e.settings.url),(r.getTime()-g)/1e3,parseInt(g/1e3),t.file.size*(t.file.percent/100),"jssdk-"+e.runtime,n.size)}})),logger.debug("bind Error event"),y.bind("FileUploaded",(S=r,function(t,r,e){logger.debug("FileUploaded event activated"),logger.debug("FileUploaded file: ",r),logger.debug("FileUploaded info: ",e);var o=new Date,n=function(r,o,n){if(logger.debug("FileUploaded last step:",n),k.downtoken_url){var i=that.createAjax();i.open("POST",k.downtoken_url,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){var e;try{e=that.parseJSON(i.responseText)}catch(e){throw"invalid json format"}var t={};plupload.extend(t,that.parseJSON(n.response),e),n.response=that.stringifyJSON(t),S&&S(r,o,n)}else y.trigger("Error",{status:i.status,response:i.responseText,file:o,code:plupload.HTTP_ERROR})},i.send("key="+that.parseJSON(n.response).key+"&domain="+k.domain)}else S&&S(r,o,n)},i=that.parseJSON(e.response);if(x=x||i.ctx,logger.debug("ctx: ",x),x){var a="";logger.debug("save_key: ",k.save_key),k.save_key||(a=(a=b(t,r,that.key_handler))?"/key/"+that.URLSafeBase64Encode(a):"");var s="/fname/"+that.URLSafeBase64Encode(r.name);logger.debug("op.x_vars: ",k.x_vars);var u=k.x_vars,l="",d="";if(void 0!==u&&"object"===(void 0===u?"undefined":_typeof(u)))for(var g in u)u.hasOwnProperty(g)&&("function"==typeof u[g]?l=that.URLSafeBase64Encode(u[g](t,r)):"object"!==_typeof(u[g])&&(l=that.URLSafeBase64Encode(u[g])),d+="/x:"+g+"/"+l);var p,c=qiniuUploadUrl+"/mkfile/"+r.size+a+s+d,f=that.detectIEVersion();f&&f<=9?(p=new moxie.xhr.XMLHttpRequest,moxie.core.utils.Env.swf_url=k.flash_swf_url):p=that.createAjax(),p.open("POST",c,!0),p.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),console.log("uptoken:"+that.token),p.setRequestHeader("Authorization","UpToken "+that.token);var h=function(){var e;logger.debug("ajax.readyState: ",p.readyState),4===p.readyState&&(localStorage.removeItem(r.name),200===p.status?(e={status:p.status,response:p.responseText,responseHeaders:p.getAllResponseHeaders()},logger.debug("mkfile is success: ",e),n(t,r,e)):(e={status:p.status,response:p.responseText,file:r,code:-200,responseHeaders:p.getAllResponseHeaders()},logger.debug("mkfile is error: ",e),y.trigger("Error",e)))};f&&f<=9?p.bind("readystatechange",h):p.onreadystatechange=h,p.send(x),logger.debug("mkfile: ",c)}else n(t,r,e);if(!k.disable_statistics_report){console.log(e.responseHeaders);var m=e.responseHeaders.match(/(X-Reqid\:\ )([\w\.\%-]*)/i)[2].replace(/[\r\n]/g,""),v=r._start_at?r._start_at.getTime():o.getTime();statisticsLogger.log(e.status,m,_(t.settings.url),void 0,w(t.settings.url),(o.getTime()-v)/1e3,parseInt(v/1e3),r.size,"jssdk-"+t.runtime,r.size)}})),logger.debug("bind FileUploaded event"),y.bind("FilesRemoved",function(e,t){var r=new Date;if(!k.disable_statistics_report)for(var o=0;o<t.length;o++)statisticsLogger.log(ExtraErrors.Cancelled,void 0,_(e.settings.url),void 0,w(e.settings.url),(r.getTime()-t[o]._start_at.getTime())/1e3,t[o]._start_at.getTime()/1e3,t[o].size*t[o].percent/100,"jssdk-"+e.runtime,t[o].size)}),logger.debug("bind FilesRemoved event"),y.init(),logger.debug("invoke uploader.init()"),logger.debug("init uploader end"),y},this.getUrl=function(e){if(!e)return!1;e=encodeURI(e);var t=this.domain;return"/"!==t.slice(t.length-1)&&(t+="/"),t+e}}window.localStorage||(window.localStorage={setItem:function(e,t){createCookie(e,t,30)},getItem:function(e){return readCookie(e)},removeItem:function(e){createCookie(e,"",-1)}});var Qiniu=new QiniuJsSDK;global.Qiniu=Qiniu,global.QiniuJsSDK=QiniuJsSDK,"undefined"!=typeof module&&module.exports?module.exports=QiniuJsSDK:"function"==typeof define&&"object"===_typeof(define.amd)&&define.amd?define("qiniu-js",["./plupload/moxie.js","./plupload/plupload.dev.js"],function(){return QiniuJsSDK}):global.QiniuJsSDK=QiniuJsSDK}(window);