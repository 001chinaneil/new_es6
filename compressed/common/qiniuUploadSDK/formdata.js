"use strict";$(function(){var a=$("#key"),n=$("#userfile"),o=$(".selected-file"),s=$(".progress"),l=$(".uploaded-result");$("#userfile").change(function(){l.html("");var t=n.val();if(!t)return!1;var e=Math.random().toString(36).substr(2)+n.val().match(/\.?[^.\/]+$/);a.val(e),o.html("文件："+t);var r=new FormData(document.getElementById("testform"));return $.ajax({url:"http://upload.qiniu.com/",type:"POST",data:r,processData:!1,contentType:!1,xhr:function(){return myXhr=$.ajaxSettings.xhr(),myXhr.upload&&myXhr.upload.addEventListener("progress",function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;s.html("上传："+t.loaded+"/"+t.total+" bytes. "+e.toFixed(2)+"%")}},!1),myXhr},success:function(t){console.log("成功："+JSON.stringify(t));var e="<span>已上传："+t.key+"</span>";t.key&&t.key.match(/\.(jpg|jpeg|png|gif)$/)&&(e+='<img src="'+domain+t.key+'"/>'),l.html(e)},error:function(t){console.log("失败:"+JSON.stringify(t)),l.html("上传失败："+t.responseText)}}),!1})});