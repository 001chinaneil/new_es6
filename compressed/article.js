"use strict";if(0<$("#active-box").length){var url="/active/group",active_list=[];$.ajax({type:"post",url:url,data:[],dataType:"json",async:!0,success:function(e){if(1==e.result){var a="";active_list=e.data,$.each(e.data,function(e,t){a+='<option value="'+t.group_id+'" data-index="'+e+'">'+t.title+"</option>"}),$("#first_level").append(a),$("#group_id").val()&&($("#first_level").val($("#group_id").val()),$("#first_level").trigger("change"))}else Messenger().post({message:e.msg,type:"error",showCloseButton:!0})}}),$("body").on("change","#first_level",function(){var s=$(this).children("option:selected").val();$.each(active_list,function(e,t){if(t.group_id==s)if(t.history_activities){var a="";$("#second_level").empty().addClass("hide"),$.each(t.history_activities,function(e,t){a+='<option value="'+t.hid+'">'+t.period_name+"</option>"}),$("#second_level").append(a).removeClass("hide"),$("#activity_id").val()&&$("#second_level").val($("#activity_id").val())}else $("#second_level").empty().addClass("hide")})})}function initReward(){var e=$("input[name='is_open_reward']").prop("checked")?1:0;$("input[name='is_open_reward']").val(e)}function normalPulishSure(){var e=$("#dateline").val(),t=$("#title").val();if(!e){var a=new Date;e=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()}$(".js-article-tag-ul li.active span").html();dialogBox("publishModal","确定发布?",'<div class="control-group"><label for="articleLink" class="control-label">文章标题：</label><div class="controls">'+t+'</div></div><div class="control-group"><label for="articleLink" class="control-label">发布时间：</label><div class="controls">'+e+"</div></div>",'<button class="btn btn-success btn-article-publish-confirm">确定</button>')}function add_article(e){if(0<$("#official-notes").length)var t=get_article_notes_data();else t=get_article_data();if(""==t.authorid||0==t.authorid)return Messenger().post({message:"选择一个作者吧,不然不能发布",hideAfter:5,type:"error",hideOnNavigate:!0}),!1;t.status=e;var a="";"article"==$(".js-article-tag-ul li.active").attr("data-type")?0==t.channel.length&&0==t.collection.length&&0==t.sponsor.length&&(a="确定不选择任何分类吗?"):"sponsor"==$(".js-article-tag-ul li.active").attr("data-type")&&0==t.sponsor.length&&(a="确定不选择赞助类型吗?");var s=function(){$.ajax({type:"post",url:"/article/article_add_action",data:t,dataType:"json",async:!0,success:after_article_add_action})};if(a){if(confirm(a)){if(0<$("#column_type").length&&"column"===$("#column_type").val()&&(""===$("#column_keyword").val()||""===$("#column_summary").val()))return void Messenger().post({message:"关键词和简介不能为空",hideAfter:3,type:"error",hideOnNavigate:!0});if(0!==$("#review").length&&$("#review").val().length<20)return void alert("点评语必须在20～200字以内");s()}}else{if(0<$("#column_type").length&&"column"===$("#column_type").val()&&(""===$("#column_keyword").val()||""===$("#column_summary").val()))return void Messenger().post({message:"关键词和简介不能为空",hideAfter:3,type:"error",hideOnNavigate:!0});s()}}$(document).on("click",".js-close-reward",function(e){var t=$("input[name='is_open_reward']").val();1==t?(t=0,$("input[name='is_open_reward']").val(t).prop("checked",!1)):(e.preventDefault(),$.ajax({url:"/reward/checkIsOpenReward",dataType:"json",success:function(e){e.success&&(1==e.data.is_open_reward?(t=1,$("input[name='is_open_reward']").prop("checked",!0)):($("input[name='is_open_reward']").prop("checked",!1),Messenger().post({message:"您的账号已关闭赞赏功能，请到个人中心打开，再设置本文赞赏",type:"error",hideAfter:3,showCloseButton:!0}),t=0),$("input[name='is_open_reward']").val(e.data.is_open_reward))}}))}),initReward(),$(document).delegate(".btn-article-publish","click",function(){normalPulishSure()}),$("body").on("click",".btn-article-ignore",function(){$(this).addClass("hide"),$(".btn-article-publish-confirm").removeClass("hide"),$("#error_html").addClass("hide"),$("#e_strHtml").removeClass("hide")}),$(document).on("click",".btn-article-publish-confirm",function(){var e=$(this);1==source_status?0==$("#review").val().length||""==$("#review").val()?Messenger().post({message:"点评不能为空!",type:"error",hideAfter:3,showCloseButton:!0}):$("#review").val().length<20?Messenger().post({message:"点评最少20字!",type:"error",hideAfter:3,showCloseButton:!0}):(e.addClass("noReturn"),add_article(0)):(e.addClass("noReturn"),add_article(0))}),$(document).delegate(".btn-article-save-draft","click",function(){$(this).addClass("noReturn"),add_article(6)}),0<$(".js-editor").length&&($(document).ready(function(){setTimeout(function(){""!=UE.getEditor("myEditor").execCommand("getlocaldata")&&UE.getEditor("myEditor").setContent(UE.getEditor("myEditor").execCommand("getlocaldata"))},500)}),window.onbeforeunload=function(e){$(".js-submit-huknows").hasClass("noReturn")||$(".btn-article-publish-confirm").hasClass("noReturn")||$(".btn-article-save-draft").hasClass("noReturn")||$("#article_save_confirm").hasClass("noReturn")||$(".btn-article-save-confirm").hasClass("noReturn")||$("#article_check_save").hasClass("noReturn")||$("#article_ignore_save").hasClass("noReturn")||$("#article_author_appeal_save").hasClass("noReturn")||$("#article_final_check_save").hasClass("noReturn")||$("#article_delete_save").hasClass("noReturn")||$("#article_draft_save").hasClass("noReturn")||((e=e||window.event).returnValue=" ")}),$(document).delegate(".article-edit","click",function(){var t=$(this),aid=$(this).attr("aid"),post_data={aid:aid},status=$(this).attr("status");$.post("/article/article_get",{huxiu_hash_code:huxiu_hash_code,aid:aid},function(data){data=eval("("+data+")"),1==data.result&&(data.data.status==status?$.ajax({type:"post",url:"/article/article_edit_check",data:post_data,dataType:"json",async:!0,success:function(e){if(1==e.result){var a="";"1"==t.attr("is_video_article")&&(a="?article_type=video"),location.href="/article/edit/"+aid+a}else article_modal("article_edit_confirm",aid,e.msg+"<br>您确定要编辑吗?")}}):(0==data.data.status?Messenger().post({message:"该文章已发布",hideAfter:3,type:"error",hideOnNavigate:!0}):1==data.data.status?Messenger().post({message:"该文章正在审核中",hideAfter:3,type:"error",hideOnNavigate:!0}):2==data.data.status?Messenger().post({message:"该文章已被忽略",hideAfter:3,type:"error",hideOnNavigate:!0}):3==data.data.status?Messenger().post({message:"该文章作者正在申诉",hideAfter:3,type:"error",hideOnNavigate:!0}):4==data.data.status?Messenger().post({message:"该文章已终审",hideAfter:3,type:"error",hideOnNavigate:!0}):5==data.data.status?Messenger().post({message:"该文章已删除",hideAfter:3,type:"error",hideOnNavigate:!0}):6==data.data.status&&Messenger().post({message:"该文章在草稿箱",hideAfter:3,type:"error",hideOnNavigate:!0}),location.reload()))})}),$(document).delegate(".about-edit","click",function(){var aid=$(this).attr("aid"),post_data={aid:aid},status=$(this).attr("status");$.post("/article/article_get",{huxiu_hash_code:huxiu_hash_code,aid:aid},function(data){data=eval("("+data+")"),1==data.result&&(data.data.status==status?$.ajax({type:"post",url:"/article/article_edit_check",data:post_data,dataType:"json",async:!0,success:function(e){1==e.result?location.href="/about/edit/"+aid:article_modal("about_edit_confirm",aid,e.msg+"<br>您确定要编辑吗?")}}):(0==data.data.status?Messenger().post({message:"该文章已发布",hideAfter:3,type:"error",hideOnNavigate:!0}):1==data.data.status?Messenger().post({message:"该文章正在审核中",hideAfter:3,type:"error",hideOnNavigate:!0}):2==data.data.status?Messenger().post({message:"该文章已被忽略",hideAfter:3,type:"error",hideOnNavigate:!0}):3==data.data.status?Messenger().post({message:"该文章作者正在申诉",hideAfter:3,type:"error",hideOnNavigate:!0}):4==data.data.status?Messenger().post({message:"该文章已终审",hideAfter:3,type:"error",hideOnNavigate:!0}):5==data.data.status?Messenger().post({message:"该文章已删除",hideAfter:3,type:"error",hideOnNavigate:!0}):6==data.data.status&&Messenger().post({message:"该文章在草稿箱",hideAfter:3,type:"error",hideOnNavigate:!0}),location.reload()))})}),$(document).delegate("#article_edit_confirm","click",function(){var e=$(this).attr("typeid");location.href="/article/edit/"+e}),$(document).delegate("#about_edit_confirm","click",function(){var e=$(this).attr("typeid");location.href="/about/edit/"+e}),$(document).delegate("#article_save_confirm","click",function(){$(this).addClass("noReturn"),article_edit_save($(this).attr("status"))}),$(document).delegate("#about_save_confirm","click",function(){$(this).addClass("noReturn"),about_article_edit_save()});var hasExternalPic=function(){for(var e={flag:!1,num:0},t=UE.htmlparser(UE.getEditor("myEditor").getContent(),!0).getNodesByTagName("img"),a=0;a<t.length;a++)t[a].attrs.src&&-1==t[a].attrs.src.indexOf("img.huxiucdn.com")&&-1==t[a].attrs.src.indexOf("images.bipush.com")&&-1==t[a].attrs.src.indexOf("images.huxiu.com")&&-1==t[a].attrs.src.indexOf("imgs.bipush.com")&&-1==t[a].attrs.src.indexOf("img-proxy.huxiu.com")&&(e.flag=!0,e.num+=1);return e};function edit_article(t,a){if(!a.hasClass("disabled")){a.addClass("disabled");var e={aid:aid};$.ajax({type:"post",url:"/article/article_edit_save_check",data:e,dataType:"json",async:!0,success:function(e){1==e.result?article_edit_save(t):article_modal("article_save_confirm",aid,e.msg+"<br>您确定要保存吗?",t),a.removeClass("disabled")}})}}function edit_about_article(t,a){if(!a.hasClass("disabled")){a.addClass("disabled");var e={aid:aid};$.ajax({type:"post",url:"/article/article_edit_save_check",data:e,dataType:"json",async:!0,success:function(e){console.log(e),1==e.result?about_article_edit_save(t):article_modal("about_save_confirm",aid,e.msg+"<br>您确定要保存吗?"),a.removeClass("disabled")}})}}function get_about_article_data(){var e=$(".js-article-tag-ul li.active").attr("data-type"),t=-1;0<$(".js-author-box").length&&(-1==(t=$(".js-author-box .box-info-wrap input[type='radio']:checked").val())&&(t=$("#article_authour").val()),-2==t&&(t=$("#source").val()));var a=$("#title").val(),s=$("#subtitle").val(),i=$("#list_title").val(),o=$("#digest"),r=o.val();r==o.attr("placeholder")&&(r="");var n=$("#myEditor").val(),l=$("#source").val(),c=$("#source_url").val(),d=$("#article_tags").val(),u=new Array;$.each($(".related-list li"),function(e){u[e]=$(this).attr("aid")});var p,h=$("#dateline").val(),m=$("#disallow_comment").hasClass("active")?0:1,g=[],v=$(".js-article-channel-ul li.active"),f=[],_=$(".js-commonColumn-option").next(".commonColumnBox").find("li.active span"),y=[],b=$(".js-article-sponsor-ul li.active");return $.each(v,function(e){var t=$(this);g[e]=t.attr("catid")}),$.each(_,function(e){var t=$(this);f[e]=t.attr("data-collection_id")}),$.each(b,function(e){var t=$(this);y[e]=t.attr("catid")}),p={article_type:e,authorid:t,title:a,subtitle:s,list_title:i,summary:r,content:n,source:l,source_url:c,pic:pic_url,pic1:pic1_url,list_pic:list_pic_url,tags:d,related_articles:u,pic_attach_id:pic_attach_id,list_pic_attach_id:list_pic_attach_id,dateline:h,allow_comment:m,status:status,channel:g,collection:f,sponsor:y,special:[],outline:$("#outline").prop("checked")?1:0},0<$(".js-special-id").length&&(p.special=$(".js-special-id").attr("data-id").split(",")),p}function get_article_data(){var e=$(".js-article-tag-ul li.active").attr("data-type"),t=-1;0<$(".js-author-box").length&&(-1==(t=$(".js-author-box .box-info-wrap input[type='radio']:checked").val())&&(t=$("#article_authour").val()),-2==t&&(t=$("#source").val()));var a=$("#title").val(),s=$("#subtitle").val(),i=$("#list_title").val(),o=$("#digest"),r=o.val();r==o.attr("placeholder")&&(r="");var n=UE.getEditor("myEditor").getContent(),l=$("#source").val(),c=$("#source_url").val(),d=$("#article_tags").val(),u=new Array;$.each($(".related-list li"),function(e){u[e]=$(this).attr("aid")});var p,h,m=$("#dateline").val(),g=$("#disallow_comment").hasClass("active")?0:1,v=$("#second_level").val();p=$("#reprinted").attr("checked")?1:0;var f=[],_=$(".js-article-channel-ul li.active"),y=[],b=$(".js-commonColumn-option").next(".commonColumnBox").find("li.active span"),x=[],w=$(".js-article-sponsor-ul li.active");$.each(_,function(e){var t=$(this);f[e]=t.attr("catid")}),$.each(b,function(e){var t=$(this);y[e]=t.attr("data-collection_id")}),$.each(w,function(e){var t=$(this);x[e]=t.attr("catid")});var j=GetQueryString("article_type");j="video"==j?1:0,h={article_type:e,authorid:t,title:a,subtitle:s,list_title:i,summary:r,content:n,source:l,source_url:c,pic:pic_url,pic1:pic1_url,list_pic:list_pic_url,tags:d,related_articles:u,pic_attach_id:pic_attach_id,list_pic_attach_id:list_pic_attach_id,dateline:m,allow_comment:g,status:status,activity_id:v,reprinted_status:p,share_pic:"https://img.huxiucdn.com/article/cover/201703/11/175600370063.png"==$(".article-share-pic img").attr("src")?"":$(".article-share-pic img").attr("src"),novip_summary:$("#novip_summary").val(),channel:f,collection:y,sponsor:x,special:[],video_id:video_id,is_video:j,outline:$("#outline").prop("checked")?1:0,is_index_show:$("#is_index_show").prop("checked")?1:0,is_baidu_original:$("#is_baidu_original").prop("checked")?1:0,column_type:$("#column_type").val(),column_id:$("#column_id").val(),column_keyword:$("#column_keyword").val(),column_summary:$("#column_summary").val(),vip_column_id:$("#vip_column_id").val(),is_free:0};var k=$("#audio_url").val();return 0<$("#audio_url").length&&""!==k&&(h.audio_path=k),0<$("#rewardText").length&&(""==$("#rewardText").val()?h.reward_guide="别打CALL，打钱":h.reward_guide=$("#rewardText").val(),$("#closeReward").prop("checked")?h.is_open_reward=1:h.is_open_reward=0),0<$(".js-special-id").length&&(h.special=$(".js-special-id").attr("data-id").split(",")),"report"==e?(h.pdf_url=$(".pdf-url").val(),h.report_type=1,h.report_tag=$("#report_tag").val(),h.cover=$("#active-pic").attr("src")):"weekly"==e?(h.report_type=2,h.report_type=2,h.weekly_type=$("input[name=weekly_type]:checked").val(),h.weekly_start_time=$("#weekly_start_time").val(),h.weekly_end_time=$("#weekly_end_time").val(),h.report_tag=$("#weekly_tag").val()):"vip_column"==e&&(h.report_type=4),1==source_status&&(h.source_status=source_status,h.review=$("#review").val(),h.news_id=news_id,h.news_type=news_type),h}function get_article_notes_data(){$(".js-article-tag-ul li.active").attr("data-type");var e=-1;0<$(".js-author-box").length&&(-1==(e=$(".js-author-box .box-info-wrap input[type='radio']:checked").val())&&(e=$("#article_authour").val()),-2==e&&(e=$("#source").val()));var t=$("#title").val(),a=$("#subtitle").val(),s=$("#list_title").val(),i=$("#digest"),o=i.val();o==i.attr("placeholder")&&(o="");var r=UE.getEditor("myEditor").getContent(),n=$("#source").val(),l=$("#source_url").val(),c=$("#article_tags").val(),d=new Array;$.each($(".related-list li"),function(e){d[e]=$(this).attr("aid")});var u,p=$("#dateline").val();u={authorid:e,title:t,subtitle:a,list_title:s,summary:o,content:r,source:n,source_url:l,pic:pic_url,pic1:pic1_url,list_pic:list_pic_url,tags:c,related_articles:d,pic_attach_id:pic_attach_id,list_pic_attach_id:list_pic_attach_id,dateline:p,status:status,activity_id:$("#hid").val(),share_pic:"https://img.huxiucdn.com/article/cover/201703/11/175600370063.png"==$(".article-share-pic img").attr("src")?"":$(".article-share-pic img").attr("src"),novip_summary:$("#novip_summary").val(),special:[],report_type:3,vip_column_id:$("#vip_column_id").val()};var h=$("#audio_url").val();return 0<$("#audio_url").length&&""!==h&&(u.audio_path=h),0<$("#rewardText").length&&(""==$("#rewardText").val()?u.reward_guide="别打CALL，打钱":u.reward_guide=$("#rewardText").val(),$("#closeReward").prop("checked")?u.is_open_reward=1:u.is_open_reward=0),$("#closeReward").prop("checked")?u.is_open_reward=1:u.is_open_reward=0,u}function article_edit_save(e){if(0<$("#official-notes").length)var t=get_article_notes_data();else t=get_article_data();t.status=e,t.aid=aid;var a="";"article"==$(".js-article-tag-ul li.active").attr("data-type")?0==t.channel.length&&0==t.collection.length&&0==t.sponsor.length&&(a="确定不选择任何分类吗？"):"sponsor"==$(".js-article-tag-ul li.active").attr("data-type")&&0==t.sponsor.length&&(a="确定不选择赞助类型吗");var s=function(){$.ajax({type:"post",url:"/article/article_edit_action",data:t,dataType:"json",async:!0,success:after_article_edit_action})};if(a){if(confirm(a)){if(0<$("#column_type").length&&"column"===$("#column_type").val()&&(""===$("#column_keyword").val()||""===$("#column_summary").val()))return void Messenger().post({message:"关键词和简介不能为空",hideAfter:3,type:"success",hideOnNavigate:!0});s()}}else{if(0<$("#column_type").length&&"column"===$("#column_type").val()&&(""===$("#column_keyword").val()||""===$("#column_summary").val()))return void Messenger().post({message:"关键词和简介不能为空",hideAfter:3,type:"success",hideOnNavigate:!0});s()}}function about_article_edit_save(e){var t=get_about_article_data();t.status=e,t.aid=aid,$.ajax({type:"post",url:"/article/about_article_edit_action",data:t,dataType:"json",async:!0,success:after_about_article_edit_action})}function article_localStore(e){var t=[];t.push({id:e.aid,content:UE.getEditor("myEditor").getContent()}),localStorage.setItem("article_list",JSON.stringify(t))}function after_article_add_action(e){1==e.result?(article_localStore(e),6==e.status?location.href="/article/edit/"+e.aid:location.href="/article/push/"+e.aid):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),UE.getEditor("myEditor").execCommand("clearlocaldata"),$(this).removeClass("disabled")}function after_article_edit_action(e){1==e.result?(article_localStore(e),6==e.status?Messenger().post({message:"草稿保存成功",type:"success",hideAfter:3,showCloseButton:!0}):location.href="/article/push/"+e.aid):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),UE.getEditor("myEditor").execCommand("clearlocaldata")}function after_about_article_edit_action(e){1==e.result?location.href="/about":Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),UE.getEditor("myEditor").execCommand("clearlocaldata")}function postTypeDelete(e,t,a,s){htmlBox("pushModal","提示",'<div class="modal-body"><div><span class="text text-error"><span>'+("audit"==s?"您确定要审核通过吗?":"您确定要删除吗?")+'</span></span></div></div><div class="modal-footer"><button type_flag="'+s+'" typename="'+t+'" pid="'+a+'" class="btn btn-success article-delete" data-dismiss="modal" aria-hidden="true">确定</button><button class="btn" data-dismiss="modal" aria-hidden="true">取消</button></div>')}$(document).delegate("#article_check_save_pub, #article_draft_save_pub","click",function(){var e=$("#dateline").val(),t=$("#title").val();if(e){var a=parseInt(new Date(e.replace(/-/g,"/")).getTime()/1e3),s=Math.round((new Date).getTime()/1e3);a<s&&(a=s)}else a=parseInt((new Date).getTime()/1e3);var i=new Date(1e3*parseInt(a)),o=i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()+" "+i.getHours()+":"+i.getMinutes();$("#dateline").val(o);dialogBox("publishModal","发布",'<div class="control-group"><label for="articleLink" class="control-label">文章标题：</label><div class="controls">'+t+'</div></div><div class="control-group"><label for="articleLink" class="control-label">发布时间：</label><div class="controls">'+o+"</div></div>",'<button class="btn btn-success btn-article-save-confirm">确定</button>')}),$(document).delegate("#about_article_save","click",function(){dialogBox("publishModal","发布",'<div class="control-group"><label for="articleLink" class="control-label">文章标题：</label><div class="controls">'+$("#title").val()+"</div></div>",'<button class="btn btn-success btn-about-article-save-confirm">确定</button>')}),$(document).delegate("#article_save","click",function(){var e=$("#dateline").val(),t=$("#title").val();if(!e){var a=new Date;e=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()}$(".js-article-tag-ul li.active span").html();dialogBox("publishModal","发布",'<div class="control-group"><label for="articleLink" class="control-label">文章标题：</label><div class="controls">'+t+'</div></div><div class="control-group"><label for="articleLink" class="control-label">发布时间：</label><div class="controls">'+e+"</div></div>",'<button class="btn btn-success btn-article-save-confirm">确定</button>')}),$(document).delegate(".btn-article-save-confirm","click",function(){$(this).addClass("noReturn"),edit_article(0,$(this))}),$(document).delegate(".btn-about-article-save-confirm","click",function(){$(this).addClass("noReturn"),edit_about_article(0,$(this))}),$(document).delegate("#article_check_save","click",function(){$(this).addClass("noReturn"),edit_article(1,$(this))}),$(document).delegate("#article_ignore_save","click",function(){$(this).addClass("noReturn"),edit_article(2,$(this))}),$(document).delegate("#article_author_appeal_save","click",function(){$(this).addClass("noReturn"),edit_article(3,$(this))}),$(document).delegate("#article_final_check_save","click",function(){$(this).addClass("noReturn"),edit_article(4,$(this))}),$(document).delegate("#article_delete_save","click",function(){$(this).addClass("noReturn"),edit_article(5,$(this))}),$(document).delegate("#article_draft_save","click",function(){$(this).addClass("noReturn"),edit_article(6,$(this))}),$(document).delegate(".article-delete-confirm","click",function(){var t=$(this),aid=t.attr("aid"),status=t.attr("status");$.post("/article/article_get",{huxiu_hash_code:huxiu_hash_code,aid:aid},function(data){data=eval("("+data+")"),1==data.result&&(data.data.status==status?postTypeDelete(t,"aid",aid):(0==data.data.status?Messenger().post({message:"该文章已发布",hideAfter:3,type:"error",hideOnNavigate:!0}):1==data.data.status?Messenger().post({message:"该文章正在审核中",hideAfter:3,type:"error",hideOnNavigate:!0}):2==data.data.status?Messenger().post({message:"该文章已被忽略",hideAfter:3,type:"error",hideOnNavigate:!0}):3==data.data.status?Messenger().post({message:"该文章作者正在申诉",hideAfter:3,type:"error",hideOnNavigate:!0}):4==data.data.status?Messenger().post({message:"该文章已终审",hideAfter:3,type:"error",hideOnNavigate:!0}):5==data.data.status?Messenger().post({message:"该文章已删除",hideAfter:3,type:"error",hideOnNavigate:!0}):6==data.data.status&&Messenger().post({message:"该文章在草稿箱",hideAfter:3,type:"error",hideOnNavigate:!0}),location.reload()))})}),$(document).delegate(".comment-del-comfirm-btn","click",function(){var e=$(this),t=$(this).attr("pid");postTypeDelete(e,$("#typeName").val(),t,e.attr("data-type"))}),$(document).delegate(".tag-del-btn","click",function(){postTypeDelete($(this),"tag_id",$(this).attr("tag_id"))}),$(document).delegate(".all-del-btn","click",function(){var e=$(this),t=$(".active-list-box").eq(0);if(!e.hasClass("disabled")){var a=new Array,s=new Array,i=new Array,o=new Array,r=new Array;if(console.log(t.attr("data-fid")),void 0!==t.attr("aid"))$.each($(".active-list .ipt-checkbox:checked"),function(e){a[e]=$(this).parents(".active-list-box").attr("aid")}),postTypeDelete(e,"aid",a);else if(void 0!==t.attr("pid")){$.each($(".active-list .ipt-checkbox:checked"),function(e){s[e]=$(this).parents(".active-list-box").attr("pid")});var n=$("#typeName").val(),l="audit"==e.attr("data-type")?"audit":"";postTypeDelete(e,n,s,l)}else void 0!==t.attr("tag_id")?($.each($(".active-list .ipt-checkbox:checked"),function(e){i[e]=$(this).parents(".active-list-box").attr("tag_id")}),postTypeDelete(e,"tag_id",i)):void 0!==t.attr("gid")?($.each($(".active-list .ipt-checkbox:checked"),function(e){o[e]=$(this).parents(".active-list-box").attr("gid")}),postTypeDelete(e,"guest_id",o)):void 0!==t.attr("data-fid")&&($.each($(".active-list .ipt-checkbox:checked"),function(e){r[e]=$(this).parents(".active-list-box").attr("data-fid")}),postTypeDelete(e,"fid",r))}}),$(document).delegate(".article-delete","click",function(){var e=$(this),t="",a={huxiu_hash_code:huxiu_hash_code,pid:e.attr("pid")},s=e.attr("typename");"aid"==s?(a.status=5,a.aid=e.attr("pid"),t="/article/article_change_status_action"):"article"==s?t="audit"==e.attr("type_flag")?"/comment/auditFromArticle":"/comment/deleteFromArticle":"article_r"==s?t="audit"==e.attr("type_flag")?"/comment/auditFromArticleReply":"/comment/deleteFromArticleReply":"tag_id"==s?(a.tag_id=e.attr("pid"),t="/tag/delete_action"):"rumor"==s?t="/comment/deleteFromRumor":"rumor_r"==s?t="/comment/deleteFromRumorReply":"topic"==s?(a.comment_id=e.attr("pid"),t="/topic/batchDeleteComment "):"topic_r"==s?(a.reply_id=e.attr("pid"),t="/topic/batchDeleteReply  "):"active"==s?t="/comment/deleteFromActivity":"active_r"==s?t="/comment/deleteFromActivityReply":"chuangye"==s?t="/comment/deleteFromChuangYe":"chuangye_r"==s?t="/comment/deleteFromChuangYeReply":"guest_id"==s?(t="/active/deleteGuest",a.id=e.attr("pid").split(",")):"fid"==s&&(t="/feedback/delete",a.id=e.attr("pid").split(",")),$.ajax({type:"post",url:t,data:a,dataType:"json",async:!0,success:function(e){"aid"==s||"tag_id"==s||"guest_id"==s||"fid"==s?1==e.result?(Messenger().post({message:e.msg||"删除成功",type:"success",showCloseButton:!0}),window.location.reload()):Messenger().post({message:e.msg,type:"error",showCloseButton:!0}):e.success?(Messenger().post({message:e.data.msg,type:"success",showCloseButton:!0}),window.location.reload()):Messenger().post({message:e.error.msg,type:"error",showCloseButton:!0})}})}),$(function(){$("#cover_upload_pic").change(function(){$("#cover_upload_form").submit()})}),$(function(){$("#cover_upload_pic2").change(function(){$("#cover_upload_form2").submit()})}),$(".js-manage-article-photo-box").on("click",".js-img-all-del, .js-img-del",function(){var btn=$(this),oParent=btn.parents("li"),oCheckbox,url="/article/article_attachment_delete_action",attachid=[],param={huxiu_hash_code:huxiu_hash_code};if(btn.hasClass("js-img-del"))attachid.push(oParent.find(".item-m .item-m-img img").attr("attachid")),param.attachid=attachid;else if(btn.hasClass("js-img-all-del")){oParent=btn.parents(".js-manage-article-photo-box"),oCheckbox=oParent.find('ul li input[type="checkbox"]');var flag=!1;if($.each(oCheckbox,function(e,t){var a=$(t).parents("li");"checked"==$(t).attr("checked")&&(flag=!0,attachid.push(a.find(".item-m .item-m-img img").attr("attachid")))}),!flag)return void alert("请选择将要删除的数据！");param.attachid=attachid}$.post(url,param,function(data){data=eval("("+data+")"),1==data.result?btn.hasClass("js-img-del")?oParent.remove():btn.hasClass("js-img-all-del")&&$.each(oCheckbox,function(e,t){var a=$(t).parents("li");"checked"==$(t).attr("checked")&&a.remove()}):alert(data.msg)})}),$(".js-manage-article-photo-box").on("click",'input[type="checkbox"]',function(){var e=$(this),t=e.parents(".js-manage-article-photo-box");if("all-check"==e.attr("name")){"checked"==e.attr("checked")?t.find('input[type="checkbox"]').attr("checked","checked"):t.find('input[type="checkbox"]').removeAttr("checked")}else{var a=e.attr("checked"),s=t.find('input[name="all-check"]'),i=s.attr("checked");null==a&&"checked"==i&&s.removeAttr("checked")}});var tagInit=function(e){if("article"!=e||aid||$("#is_index_show").prop("checked",!0),$(".manage-report-article-box").hide(),$(".manage-general-article-box").hide(),$(".manage-weekly-article-box").hide(),$(".novip-summary-box").show(),"report"==e)$(".manage-report-article-box").show(),aid||$("#is_index_show").prop("checked",!1);else if("weekly"==e)$(".manage-weekly-article-box").show(),aid||$("#is_index_show").prop("checked",!1);else if(0==$("#vip_column_id").val()&&($(".manage-general-article-box").show(),$(".novip-summary-box").hide()),"sponsor"==e)$(".sponsor-article-box").show(),aid||$("#is_index_show").prop("checked",!1);else if("video"==e){$(".article-video-wrap").show(),"sponsor"==$(".js-article-tag-ul li.active").attr("data-type")?$(".sponsor-article-box").show():$(".sponsor-article-box").hide()}else $(".sponsor-article-box").hide()},digestNum;function GetQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null}function ignore_reasons(aid){var url="/article/article_reasons",post_data={huxiu_hash_code:huxiu_hash_code};$.post(url,post_data,function(data){data=eval("("+data+")");var html="";for(i=0;i<data.data.length;i++)html+='<label class="new-lb"><input id="'+data.data[i].id+'" name="reason" value="'+data.data[i].message+'" type="checkbox">'+data.data[i].message+"</label>";if(1==data.result){var strHtml='<div class="clearfix"><div class="pull-left">忽略理由如下:</div><div class="modal-manage pull-right"><a class="js-modal-manage" href="javascript:void(0);">管理</a></div></div><div class="reason-box js-reason-box">'+html+'<label class="new-lb"><textarea class="js-custom-reason" placeholder="您可在此输入自定义忽略理由"></textarea></label></div><div class="reason-edit-box js-reason-edit-box"></div>',title="忽略",strBtn='<button class="btn btn-success article-check-ignore-conform" aid='+aid+' data-dismiss="modal" aria-hidden="true">确定</button>';dialogBox("ignoreModal",title,strHtml,strBtn)}})}function dialogBox(e,t,a,s){var i='<div id="'+e+'" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button><h4 id="myModalLabel">'+t+'</h4></div><div class="modal-body">'+a+'</div><div class="modal-footer">'+s+'&nbsp;&nbsp;&nbsp;&nbsp;<button class="btn" data-dismiss="modal" aria-hidden="true">取消</button></div></div>';0<$("#"+e).length&&$("#"+e).remove(),$("body").append(i),$("#"+e).modal()}($(function(){var s="";if(GetQueryString("article_type"))if("video"==(s=GetQueryString("article_type")))$(".article-video-wrap").show(),$("#head-app-pic").hide(),$(".js-pic-size").hide(),$(".js-video-pic-size").show();else{$(".js-article-tag-ul li").removeClass("active");var e=$(".js-article-tag-ul li");$.each(e,function(e,t){var a=$(this);if(a.attr("data-type")==s)return a.addClass("active"),!1})}else s=$(".js-article-tag-ul li.active").attr("data-type");tagInit(s)}),$(document).on("click",".article-check-ignore",function(){var $t=$(this),dataType=$t.attr("data-type"),boxWrap=$(".active-list-box").eq(0),aid="",status=$t.attr("status");if("all-ignore"==dataType&&$t.attr("data-article-status")==status){if(!$t.hasClass("disabled")){var ignoreAid=new Array;void 0!==boxWrap.attr("aid")&&$.each($(".active-list .ipt-checkbox:checked"),function(e){ignoreAid[e]=$(this).parents(".active-list-box").attr("aid")})}aid=ignoreAid.join(","),ignore_reasons(aid)}else aid=$t.attr("aid"),$.post("/article/article_get",{huxiu_hash_code:huxiu_hash_code,aid:aid},function(data){data=eval("("+data+")"),1==data.result&&(data.data.status==status?ignore_reasons(aid):(0==data.data.status?alert("该文章已发布"):1==data.data.status?alert("该文章正在审核中"):2==data.data.status?alert("该文章已被忽略"):3==data.data.status?alert("该文章作者正在申诉"):4==data.data.status?alert("该文章已终审"):5==data.data.status?alert("该文章已删除"):6==data.data.status&&alert("该文章在草稿箱"),location.reload()))})}),$(document).on("click",".article-check-ignore-conform",function(){var btn=$(this),oParent=btn.parents(".modal"),oReasonBox=oParent.find(".js-reason-box"),iReason=oReasonBox.find(".js-custom-reason").val(),aid=$(this).attr("aid"),url="/article/article_ignore_action",param={huxiu_hash_code:huxiu_hash_code,aid:aid},reason=new Array,i=0;$.each(oReasonBox.find('.new-lb input[type="checkbox"]'),function(e,t){var a=$(t).val(),s=$(t).attr("id");$(t).prop("checked")&&(reason[i]={id:s,message:a},i++)}),""!=iReason&&(reason[reason.length]={id:0,message:iReason}),param.reasons=reason,param.ismessage=$("#is-group-message").prop("checked")?1:0,$.post(url,param,function(data){var data=eval("("+data+")");data.success?location.reload():alert(data.error.msg)})}),$(document).on("click",".js-modal-manage",function(){var e=$(this),t=e.parents(".modal"),a=t.find(".js-reason-box"),s=t.find(".js-reason-edit-box");$.each(a.find('.new-lb input[type="checkbox"]'),function(e,t){var a='<label class="new-lb"><span class="remove-article-reason">-</span><input id="'+$(t).attr("id")+'" name="reason" type="text" value="'+$(t).val()+'" /></label>';s.append(a)}),a.css("display","none"),e.attr("class","js-btn-reason-add").html("添加"),t.find(".article-check-ignore-conform").attr("class","btn btn-success js-btn-article-manage-ignore")}),$(document).on("click",".js-reason-edit-box .new-lb span",function(){var btn=$(this),iReasonBox=btn.parent().find('input[type="text"]'),url="/article/article_reason_delete_action",param={huxiu_hash_code:huxiu_hash_code,reason_id:iReasonBox.attr("id")};null!=iReasonBox.attr("id")?$.post(url,param,function(data){data=eval("("+data+")"),1==data.result?btn.parent().remove():alert(data.msg)}):iReasonBox.parent().remove()}),$(document).on("click",".js-btn-reason-add",function(){var e=$(this).parents(".modal").find(".js-reason-edit-box");e.prepend('<label class="new-lb"><span class="remove-article-reason">-</span><input name="reason" type="text" value="" /></label>'),e.find(".new-lb:first-child input").focus()}),$(document).on("click",".js-btn-article-manage-ignore",function(){var btn=$(this),oParent=btn.parents(".modal"),oReasonEditBox=oParent.find(".js-reason-edit-box"),urlModify="/article/article_reason_edit_action",urlAdd="/article/article_reason_add_action",paramAdd={huxiu_hash_code:huxiu_hash_code},paramModify={huxiu_hash_code:huxiu_hash_code},arrModify=[],arrAdd=[];$.each(oReasonEditBox.find('.new-lb input[type="text"]'),function(e,t){if(null==$(t).attr("id"))arrAdd.push($(t).val());else{var a={};a.id=$(t).attr("id"),a.message=$(t).val(),arrModify.push(a)}paramAdd.reason=arrAdd,paramModify.reason=arrModify}),0<arrAdd.length&&$.post(urlAdd,paramAdd,function(data){var data=eval("("+data+")");1==data.result||alert(data.msg)}),0<arrModify.length&&$.post(urlModify,paramModify,function(data){var data=eval("("+data+")");1==data.result||alert(data.msg)})}),$(".js-prdt #go_time").datetimepicker({todayBtn:"linked",autoclose:!0,format:"yyyy-mm-dd",minView:2,endDate:new Date}),0<$(".js-search").length&&$(".js-search").on("click",".js-more",function(){var e=$(this),t=e.parents(".js-search"),a=t.find(".js-search-cut"),s=t.find(".js-search-complete");"展开全文"==e.html()?(a.css("display","none"),s.css("display","inline"),e.html("收起")):"收起"==e.html()&&(a.css("display","inline"),s.css("display","none"),e.html("展开全文"))}),0<$("#digest").length)&&($("#title").keyup(function(){digestNum=20<$("#title").val().length?46:70,$("#digest").val().length>digestNum?$("#digest").css("color","#d9534f"):$("#digest").css("color","#999")}),$("#digest").keyup(function(){$("#digest").val().length>digestNum?$("#digest").css("color","#d9534f"):$("#digest").css("color","#999")}));0<$(".js-author-box").length&&$(".js-author-box .box-info-item .box-input input").click(function(){$(this).parents(".box-info-item").find('label input[type="radio"]').attr("checked","checked")});var SearchImgPost=function(e){var t={huxiu_hash_code:huxiu_hash_code,page:"1",s:$("#searchHeardImg").val()};$.ajax({type:"post",url:"",data:t,dataType:"json",async:!0,beforeSend:function(e){},success:function(e){e.result},error:function(e){}})},interceptionString=function(e){return 11<e.length&&(e=e.substring(0,11)+"..."),e},search_article_pic=!0,keyword="",getSearchImg=function(s){search_article_pic&&(search_article_pic=!1,$.ajax({type:"post",url:"/article/search_article_pic",data:{keyword:$("#searchHeardImg").val(),page:s},dataType:"json",async:!0,success:function(e){if(1==e.result){var a="",t=0;$.each(e.data,function(e,t){a+='<li><a href="'+t.url+'" target="_blank" title="'+t.title+'">'+interceptionString(t.title)+'</a><div class="number"></div><div class="time">使用时间:'+t.time+'</div><input type="radio" class="custom" name="search-img"><img class="history-img"  src="'+t.pic+'?imageView2/1/w/180/h/102/imageMogr2/strip/interlace/1/quality/85" ></li>'}),1==s&&(0==e.data.length&&alert("暂无此类图片"),$(".search-img-ul").empty()),keyword==$("#searchHeardImg").val()?($(".search-img-ul").append(a),t=parseInt(s)+1):(keyword=$("#searchHeardImg").val(),$(".search-img-ul").empty().append(a),t=2),$(".search-img-info").hide(),$(".js-get-more-search-img").attr("data-page",t+""),$(".js-get-more-search-img").removeClass("hide"),$("body").on("error",".history-img",function(){$(this).attr("src",$(this).attr("src").replace("?imageView2/1/w/180/h/102/imageMogr2/strip/interlace/1/quality/85",""))})}else 1==s&&alert("暂无此类图片");search_article_pic=!0},error:function(e){}}))};function UploadFile(e,t,a){return $.ajaxFileUpload({data:{is_ajax:"1",huxiu_hash_code:huxiu_hash_code},url:e,secureuri:!1,fileElementId:t,dataType:"json",success:function(e){a(e)}}),!1}if($("body").on("keypress","#searchHeardImg",function(e){"13"==e.keyCode&&getSearchImg("1")}),$("body").on("click",".js-search-img",function(){getSearchImg("1")}),$("body").on("click",".js-open-search-pic",function(){dialogBox("searchImgModal","搜索图片",'<div class="search-img-box history-img-box"><input type="text" id="searchHeardImg" placeholder="图片关键字"><span class="input-group-addon js-search-img" data-page="1"><i class="fa fa-search"></i></span></div><ul class="search-img-ul"></ul><div class="search-img-info">搜索的结果会在这里显示</div><a class="pull-right js-get-more-search-img search-img-more hide" data-page="1">获取更多</a>','<button class="btn btn-primary js-determine-choose-img">确定</button>')}),$("body").on("click",".js-search-img,.js-get-more-search-img",function(){var e=$(this);getSearchImg(e.attr("data-page"))}),$("body").on("click",'input:radio[name="search-img"]',function(){$(".str-ok").remove(),$(".str-bok").remove();var e=$(this),a=$('<div class="str-bok">注意：该图片尺寸为：<strong></strong>*<strong></strong>，不满足网站要求！建议重新上传</div>'),s=$('<div class="str-ok"><span>注意：</span>该图片尺寸为<strong></strong>*<strong></strong>，符合网站要求，可上传使用~</div>'),t=e.next().attr("src").replace("?imageView2/1/w/180/h/102/imageMogr2/strip/interlace/1/quality/85",""),i=new Image;i.src=t,i.onload=function(){$(".str-bok").remove(),$(".str-ok").remove();var e=this.width,t=this.height;e<800||t<600?($(".modal-body").append(a),$(".str-bok strong:eq(0)").html(e),$(".str-bok strong:eq(1)").html(t)):($(".modal-body").append(s),$(".str-ok strong:eq(0)").html(e),$(".str-ok strong:eq(1)").html(t))}}),$("body").on("click",".js-determine-choose-img",function(){$(".search-img-ul li");var e=$('input:radio[name="search-img"]:checked').next().attr("src").replace("?imageView2/1/w/180/h/102/imageMogr2/strip/interlace/1/quality/85","");e&&(pic_url=e,$("#head-pic").find(".first-figure-pic img").attr("src",e),$("#head-pic").find(".first-figure-pic").removeClass("hide"),$("#head-pic").find(".first-figure-content").hide(),$("#head-pic").find(".icon-article").removeClass("hide"),$("#searchImgModal").modal("hide"))}),$("body").on("change","#report_pdf",function(e){e.target.files[0];var t=$(this);$(".pdf_name").html("正在上传...");UploadFile("/tool/report_upload","report_pdf",function(e){$(".pdf-url").val(e.data.url),$(".pdf_name").html("上传完成."),setTimeout(function(){$(".pdf_name").html("")},1e3),t.val("")})}),0<$("#myEditor").length)var ue=UE.getEditor("myEditor");function checkURL(e){var t=e;return 1==new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w .\/?%&=]*)?/).test(t)}function convert_url(e){if(!e)return"";var t,a;if(checkURL(e))if(0<e.indexOf("qq.com"))if(0<e.indexOf("vid"))-1==(t=e.trim(e).replace(/v\.qq\.com\/.+[\?\&]vid=([^&]+).*$/i,"v.qq.com/iframe/player.html?vid=$1&tiny=0&auto=0")).indexOf("https")&&(t=t.replace("http","https")),a="<iframe id='video_play' frameborder='0' height='280' width='420' src='"+t+"' allowfullscreen></iframe>";else{var s=e.split("/");if(0<s[s.length-1].indexOf(".html")){var i=s[s.length-1].replace(".html","");a=11==i.length?"<iframe id='video_play' frameborder='0' height='280' width='420' src='"+(t="https://v.qq.com/iframe/player.html?vid="+i+"&tiny=0&auto=0")+"' allowfullscreen></iframe>":'<a href="'+e+'" target="_blank" class="border-none videoA"></a>'}else a='<a href="'+e+'" target="_blank" class="border-none videoA"></a>'}else a='<a href="'+e+'" target="_blank" class="border-none videoA"></a>';else a="";return a}function createPreviewVideo(e){if(e)if(convert_url(e)){var t='<p class="text-center" >'+convert_url(e)+"</p>";$(".video-box").empty().append(t)}else $(".video-box").empty().append('<div class="error-info-box">暂不支持此网站视频，换一个视频地址试试</div>')}$("body").on("click",".js-add-pic-article",function(){var e=$(this),t='<p class="img-center-box"><img src="'+e.parent("li").find(".add-pic-article").attr("src")+'" data-w="'+e.parent("li").find(".add-pic-article").attr("data-width")+'" data-h="'+e.parent("li").find(".add-pic-article").attr("data-height")+'"></p><p><br/></p>';UE.getEditor("myEditor").execCommand("insertHtml",t),e.parent("li").remove(),$(".pic-number").html($(".js-pic-list li").length)}),$(document).ready(function(){if(0<$("#articlePicGroup").length){var e=$("#articlePicGroup"),t=e.offset().top-55;$(window).scroll(function(){if($(window).scrollTop()>t){$(window).scrollTop();e.stop().css({top:"60px","margin-left":"784px",right:"auto",position:"fixed"})}else e.stop().css({top:0,"margin-left":"0",right:"0",position:"absolute"})})}}),$("body").on("click",".js-add-video",function(){$(this);dialogBox("videoModal","上传视频",'<div class="control-group"></div><div class="control-group"><label class="control-label">视频地址：<input class="form-control" id="video_url" type="text" placeholder="视频地址"></label></div><div class="control-group"><div class="video-box"><div class="error-info-box hide">暂不支持此网站视频，换一个视频地址试试</div></div></div>','<button class="btn btn-success js-sure-add-video">确定</button>')}),$("body").on("click",".js-sure-add-video",function(){if(1!=$(".video-box").find(".error-info-box").length){var e="";if(0<$(".video-box p iframe").length)e='<p style="text-align:center"><iframe height="400" width="710" src="'+$(".video-box p iframe").attr("src")+'" frameborder="0" allowfullscreen=""></iframe></p>';else e='<p class="text-center">'+$(".video-box p").html()+"</p>";UE.getEditor("myEditor").execCommand("insertHtml",e),$("#videoModal").modal("hide")}}),$("body").on("change","#video_url",function(){$(this);createPreviewVideo($("#video_url").val())});var imgReportWH=function(){$.each($(".js-pic-list li"),function(){var e=$(this),t=e.find("img"),a=t.attr("src"),s=new Image,i="",o="";s.src=a,s.onload=function(){i=s.width,o=s.height,16/9<i/o||i<68&&o<68?e.css({"line-height":"68px"}):t.css({"max-height":"100%"})}})};imgReportWH();var imgUpload=function(a,e,t,s){var i=document.forms[0],o=new FormData(i);o.append("Filedata",e),o.append("is_ajax",1),o.append("huxiu_hash_code",huxiu_hash_code);var r='<li id="pic_list'+a+'"><div class="loading-box"><img src="https://img.huxiucdn.com/article/cover/201605/31/115241386639.png" alt=""><div class="text">上传中</div></div><div class="btn-icon-box js-delect-pic"><i class="fa fa-trash-o"></i></div><i class="btn-left-icon btn-change-icon-box js-left-icon hide"></i><i class="btn-right-icon btn-change-icon-box js-right-icon hide"></i><div class="js-add-pic-article pic-name-bg"><span>'+e.name+"</span></div></li>";$(".list-ul-box").css({"max-height":window.innerHeight-217,overflow:"auto"}),$(".article-pic-box .box-label").addClass("active"),$(".js-pic-list").append(r),$.ajax({url:t,type:"post",data:o,dataType:"json",processData:!1,contentType:!1,success:function(e){if(1==s)var t='<img class="add-pic-article" data-id="'+e.attachid+'" src="'+e.url+'" data-width="'+e.width+'" data-height="'+e.height+'">';if(2==s)t='<img class="add-pic-article" data-id="'+e.data.uuid+'" src="'+e.data.img_url+'">';$("#pic_list"+a).append(t).find(".loading-box").remove(),$("#pic_list"+a).removeAttr("id"),imgReportWH(),$(".pic-number").html($(".js-pic-list li").length)},error:function(e){}})};if($("body").on("change","#article-pic",function(){$(this);for(var e=document.getElementById("article-pic"),t=e.files,a=0;a<t.length;a++)e.files&&e.files[a]&&imgUpload(a,e.files[a],"/tool/img_cover_upload",1)}),0<$(".nano").length){var nano_init=function(){$(".nano").nanoScroller({preventPageScrolling:!1})};nano_init()}function getImageWidthAndHeight(e,s){var i=window.URL||window.webkitURL;$("#"+e).change(function(e){var t,a;console.log(t,a),(t=this.files[0])&&((a=new Image).onload=function(){s&&s({width:this.width,height:this.height,filesize:t.size}),console.log(this.width)},a.src=i.createObjectURL(t))})}$("body").on("click",".js-delect-pic",function(e){$(this).parents("li").remove(),$(".pic-number").html($(".js-pic-list li").length),0==$(".js-pic-list li").length&&$(".article-pic-box .box-label").removeClass("active")}),$("body").on("click",".js-article-tag-ul li",function(){var e=$(this),t=e.attr("data-type");$(".js-article-tag-ul li").removeClass("active"),e.addClass("active"),tagInit(t)});var updateCoords=function(e){$("#x1").val(e.x),$("#y1").val(e.y),$("#x2").val(e.x2),$("#y2").val(e.y2),$("#w").val(e.w),$("#h").val(e.h)},jcrop_api,boundx,boundy,current_image,jcropInit=function(e){var t=[0,0,560,315];1e3==e.height&&(t=[0,0,400,500]),$("#target").Jcrop({onChange:updateCoords,onSelect:updateCoords,allowSelect:!0,allowResize:!0,setSelect:t,aspectRatio:e.prop_num,addClass:"jcrop-dark",bgOpacity:"0.4",handleSize:"10"},function(){var e=this.getBounds();boundx=e[0],boundy=e[1],jcrop_api=this})};function preview(){var e=parseInt($("#x1").val()),t=parseInt($("#y1").val()),a=(parseInt($("#x2").val()),parseInt($("#y2").val()),document.getElementById("myCanvas")),s=a.getContext("2d");s.clearRect(0,0,a.width,a.height);var i=parseInt($("#w").val()),o=parseInt($("#h").val()),r=$("#target").width(),n=$("#target").height(),l=current_image.width/r,c=current_image.height/n;a.width=i*l,a.height=o*c;var d=t*c<0?0:t*c;return s.drawImage(current_image,e*l,d,i*l,o*c,0,0,a.width,a.height),a.toDataURL("image/jpeg")}var articleFileGifUpload=function(a,e){UploadFile("/tool/imageUpload/article_cover",e,function(e){if(e.success){var t="#head-pic";"pic1"==a?(pic1_url=e.data.url,t="#head-app-pic"):pic_url=e.data.url,$(t+" .first-figure-pic img").attr("src",e.data.url),$(t+" .first-figure-pic").removeClass("hide"),$(t+" .first-figure-content").hide(),$(t+" .icon-article").removeClass("hide")}else Messenger().post({message:e.error.message,type:"error",showCloseButton:!0})})},openJcropModal=function(s,i,o,r,n){(current_image=new Image).onload=function(){var e="pic";if(1e3==i.height&&(e="pic1"),"image/gif"==o.type)400<=this.width&&300<=this.height?articleFileGifUpload(e,r):Messenger().post({message:"gif图尺寸应不低于400*300像素",type:"error",showCloseButton:!0});else if(this.width>=i.width&&this.height>=i.height){dialogBox("ImgCutterModal","文章图片上传",'<div class="jcrop-pic-box"><img id="target" src="'+s+'"></div><canvas id="myCanvas" style="display:none;"></canvas><input id="x1" hidden><input id="y1" hidden><input id="x2" hidden><input id="y2" hidden><input id="w" hidden><input id="h" hidden>','<button class="btn btn-primary js-UploadFile" data-type="'+n+'"  data-pic="'+e+'" data-dismiss="modal" aria-hidden="true">上传</button>');var t=this.height,a=this.width;setTimeout(function(){a/t>i.prop_num?$("#target").css({width:"100%",height:"auto"}):a/t<i.prop_num&&$("#target").css({height:"100%",width:"auto"}),1e3==i.height&&$(".jcrop-pic-box").css({width:"320px",height:"400px",left:"120px"})},100),setTimeout(function(){jcropInit(i)},500),$("#article-heard-pic,#article-heard-icon-pic,#article-heard-pic1,#article-heard-icon-pic1").val("")}else this.width<i.width?Messenger().post({message:"图片的宽不能小于"+i.width,type:"error",showCloseButton:!0}):this.height>=i.height?Messenger().post({message:"图片的高不能小于"+i.height,type:"error",showCloseButton:!0}):Messenger().post({message:"图片尺寸不符合要求,请上传"+i.width+"*"+i.height+"尺寸的图片",type:"error",showCloseButton:!0})},current_image.src=s};$("body").on("change","#article-heard-icon-pic-knows,#article-heard-pic-knows,#article-heard-pic,#article-heard-icon-pic,#article-heard-pic1,#article-heard-icon-pic1",function(e){var t,a=$(this),s=window.URL||window.webkitURL;if(t=this.files[0]){var i={width:800,height:600,prop_num:4/3};"pic1"==a.attr("data-pic")&&(i={width:800,height:1e3,prop_num:.8}),"knows"==a.attr("data-pic")&&(i={width:800,height:640,prop_num:5/4}),"video"==GetQueryString("article_type")&&(i={width:800,height:450,prop_num:16/9}),openJcropModal(s.createObjectURL(t),i,t,a.attr("id"))}}),$(document).on("click",".js-UploadFile",function(){var a=$(this);var e=new FormData;e.append("Filedata",function(e){for(var t=window.atob(e.split(",")[1]),a=new ArrayBuffer(t.length),s=new Uint8Array(a),i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return new Blob([a],{type:"image/png"})}(preview())),e.append("is_ajax","1"),e.append("huxiu_hash_code",huxiu_hash_code),$.ajax({url:"/tool/imageUpload/article_cover",type:"POST",data:e,dataType:"json",processData:!1,contentType:!1,success:function(e){if("topic"==a.attr("data-type"))e.success?(pic_attach_id=e.attachid,pic_url=e.data.url,$("#topic-heard-img").parents("label").find(".js-thumb-img").empty().html('<img src="'+e.url+'" />')):Messenger().post({message:e.msg,type:"error",showCloseButton:!0});else if(e.success){var t="#head-pic";"pic1"==a.attr("data-pic")?(pic1_url=e.data.url,t="#head-app-pic"):pic_url=e.data.url,$(t+" .first-figure-pic img").attr("src",e.data.url),$(t+" .first-figure-pic").removeClass("hide"),$(t+" .first-figure-content").hide(),$(t+" .icon-article").removeClass("hide")}else Messenger().post({message:e.error.message,type:"error",showCloseButton:!0})}})}),commonComponents.formDataUpImg("share_pic_new","/tool/imageUpload/article_share"),0<$("#article-title").length&&($("#title").autoResize({onResize:function(){$(this).css({opacity:.8})},animateCallback:function(){$(this).css({opacity:1})},animateDuration:300,extraSpace:0}),document.getElementById("title").addEventListener("keydown",function(e){13==e.keyCode&&(e.preventDefault(),this.value+="")})),0<$("#article-edit-title").length&&$("#title").trigger("keydown"),$("body").on("click",".js-del-first-figure",function(){var e=$(this);e.parents(".first-figure-box").find(".first-figure-content").show(),e.parents(".first-figure-box").find(".icon-del").addClass("hide"),e.parents(".first-figure-box").find(".icon-pic").addClass("hide"),e.parents(".first-figure-box").find(".first-figure-pic").addClass("hide"),"pic1"==e.attr("data-pic")?pic1_url="":(pic_attach_id="",pic_url="")}),$(document).on("change",".is_free,.weekly_is_free",function(){$(this).prop("checked")?$(".novip-summary-box").hide():$(".novip-summary-box").show()}),$(document).on("click",".js-save-promotion",function(){var t=$(this),e="edit"==t.attr("data-type")?"/article/editContentPromotion":"/article/addContentPromotion",a={is_ajax:1,id:$("#id").val(),title:$("#title").val(),icon:$("#icon").attr("src"),position:$("input[name=position]:checked").val(),start_time:$("#start_time").val(),end_time:$("#end_time").val(),aid:[],tag:$("#tag").val()};if($.each($(".related-list li"),function(){var e=$(this);a.aid.push(e.attr("aid"))}),a.aid.length<3||30<a.aid.length)return Messenger().post({message:"相关文章最少3篇,最多30篇",type:"error",hideAfter:3,showCloseButton:!0}),!1;t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:e,data:a,dataType:"json",async:!0,success:function(e){1==e.result?(Messenger().post({message:e.msg,type:"success",hideAfter:3,showCloseButton:!0}),location.reload()):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),t.removeClass("disabled")}}))}),$(document).on("click",".js-edit-vip-content-promotion",function(){var t=$(this),e={is_ajax:1,id:t.attr("data-id"),status:t.attr("data-status")};t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:"/article/editContentPromotionStatus",data:e,dataType:"json",async:!0,success:function(e){t.removeClass("disabled"),"1"==e.result?(Messenger().post({message:e.msg,type:"success",hideAfter:3,showCloseButton:!0}),location.reload()):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),t.removeClass("disabled")}}))}),$(document).on("click",".js-del-vip-promotion",function(){var t=$(this),e={is_ajax:1,id:t.attr("data-id")};confirm("确定要删除吗?")&&(t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:"/article/delContentPromotion",data:e,dataType:"json",async:!0,success:function(e){t.removeClass("disabled"),"1"==e.result?(Messenger().post({message:e.msg,type:"success",hideAfter:3,showCloseButton:!0}),location.reload()):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),t.removeClass("disabled")}})))}),$("body").on("change","#special_pic_file",function(){$(this);UploadFile("/tool/imageUpload/special","special_pic_file",function(e){"1"==e.success?$("#special_pic").attr("src",e.data.url):Messenger().post({message:e.data.message,type:"error",showCloseButton:!0})})}),$("body").on("change","#special_sponsor_logo_file",function(){$(this);UploadFile("/tool/imageUpload/special","special_sponsor_logo_file",function(e){"1"==e.success?$("#special_sponsor_logo").attr("src",e.data.url):Messenger().post({message:e.data.message,type:"error",showCloseButton:!0})})}),$(document).on("click",".js-subject-add",function(){var t=$(this),e=$("[data-require = 'true']"),a="edit"==t.attr("data-type")?"/article_subject/edit":"/article_subject/add",s={id:$("#id").val(),name:$("#name").val(),img:$("#special_pic").attr("src"),introduce:$("#introduce").val(),url:$("#url").val(),is_ajax:1,label:$("#label").val(),sponsor_logo:$("#special_sponsor_logo").attr("src"),is_sponsor:$("#is_sponsor").prop("checked")?1:0};if(checkRequired(e)){if("/static/common/images/bg.png"==s.img)return Messenger().post({message:"图片不能为空",type:"error",hideAfter:3,showCloseButton:!0}),!1;t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:a,data:s,dataType:"json",async:!0,success:function(e){t.removeClass("disabled"),console.log(e),"1"==e.result?(Messenger().post({message:e.msg,type:"success",hideAfter:3,showCloseButton:!0}),window.location.href="/article_subject/index"):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),t.removeClass("disabled")}}))}}),$(document).on("click",".js-channel-add",function(){var t=$(this),e="edit"==t.attr("data-type")?"/article_channel/edit":"/article_channel/add",a={id:$("#id").val(),name:$("#name").val(),is_ajax:1,pic:$("#active-pic").attr("src")};t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:e,data:a,dataType:"json",async:!0,success:function(e){t.removeClass("disabled"),"1"==e.result?(Messenger().post({message:e.msg,type:"success",hideAfter:3,showCloseButton:!0}),window.location.href="/article_channel/index"):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),t.removeClass("disabled")}}))}),$(document).on("click",".js-collection-add",function(){var t=$(this),e=$("[data-require = 'true']"),a=$(".column-intrduce-textarea").val(),s=$("#columnPerson").val(),i=$("#column-icon").attr("data-url"),o=$("#column-headIcon").attr("data-url"),r="edit"==t.attr("data-type")?"/article_collection/edit":"/article_collection/add",n={id:$("#id").val(),name:$("#name").val(),is_ajax:1,summary:a,compere_uid:s,icon:i,head_img:o,is_sponsor:$("#is_sponsor").prop("checked")?1:0,label:$("#label").val()};if(checkRequired(e)){if(1==n.is_sponsor&&""==n.label)return Messenger().post({message:"赞助标签不可为空",type:"error",hideAfter:3,showCloseButton:!0}),!1;t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:r,data:n,dataType:"json",async:!0,success:function(e){t.removeClass("disabled"),"1"==e.result?(Messenger().post({message:e.msg,type:"success",hideAfter:3,showCloseButton:!0}),window.location.href="/article_collection/index"):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),t.removeClass("disabled")}}))}}),$(document).on("click",".js-column-add",function(){var t=$(this),e=$("[data-require = 'true']"),a=$(".column-intrduce-textarea").val(),s=$("#columnPerson").val(),i=($("#column-icon").attr("data-url"),$("#column-headIcon").attr("data-url")),o="edit"==t.attr("data-type")?"/column/edit":"/column/add",r={id:$("#id").val(),name:$("#name").val(),is_ajax:1,summary:a,compere_uid:s,head_img:i};checkRequired(e)&&(t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:o,data:r,dataType:"json",async:!0,success:function(e){t.removeClass("disabled"),"1"==e.result?(Messenger().post({message:e.msg,type:"success",hideAfter:3,showCloseButton:!0}),window.location.href="/column/index"):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),t.removeClass("disabled")}})))}),$(document).on("change",".js-column-uploadPic",function(){var a=$(this),e=a[0].files[0],t=new FormData;t.append("image",e),$.ajax({url:"/article_collection/uploadImage",type:"POST",dataType:"json",data:t,contentType:!1,processData:!1,success:function(e){if(console.log(e),console.log(e.msg),e.success){var t=e.data.img_url;a.parents(".column-uploadPicBox").find("#column-upload-pic").attr("src",t),a.attr("data-url",t)}else Messenger().post({message:e.msg,type:"error",showCloseButton:!0})},error:function(e){console.log(e)}})}),$(document).on("click",".js-append-number",function(){var e=$(".manage-subject").index($(this).parents(".manage-subject"));$("#subject-number").val(e)}),$(document).on("click",".js-subject-btn .s-btn",function(){var e=$(this),t=e.parents(".manage-subject");e.hasClass("btn-up")?t.prev(".manage-subject").before(t):e.hasClass("btn-down")?t.next(".manage-subject").after(t):e.hasClass("btn-del")&&confirm("确认要删除吗?")&&t.remove()}),$(document).on("click",".js-add-subject-box",function(){$(this);$(".manage-subject-box").append('<div class="manage-article-box manage-subject"><div class="pull-right right-btn-group js-subject-btn"><span class="s-btn btn-up" title="向上移动"><i class="fa fa-arrow-up"></i></span>&nbsp;<span class="s-btn btn-down" title="向下移动"><i class="fa fa-arrow-down"></i></span>&nbsp;<span class="s-btn btn-del"><i class="fa fa-times"></i></span></div><div class="manage-art-other manage-article-related"><div class="box-info-wrap box-info-item"><label>分栏名称 :</label><div class="box-input"> <input type="text" class="name"  placeholder="2-15个字符" maxlength="15"></div></div></div><div class="manage-art-other manage-article-related"><span class="btn add-related-modal js-append-number"><i class="fa fa-plus"></i>添加相关文章</span><br><ol class="clearfix related-list"></ol></div></div>')}),$(document).on("click",".js-article-edit-status",function(){var t=$(this),e=t.attr("data-url"),a={id:t.attr("data-id"),status:t.attr("data-status"),is_ajax:1};t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:e,data:a,dataType:"json",async:!0,success:function(e){"1"==e.result?(Messenger().post({message:e.msg,type:"success",hideAfter:3,showCloseButton:!0}),location.reload()):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),t.removeClass("disabled")}}))}),$(document).on("click",".js-collection-content-add,.js-channel-content-add",function(){var t=$(this),e=t.attr("data-url"),a=t.attr("data-href"),s={id:t.attr("data-id"),is_ajax:1,aid:[]};$.each($(".related-list li"),function(){var e=$(this);s.aid.push(e.attr("aid"))}),t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:e,data:s,dataType:"json",async:!0,success:function(e){"1"==e.result?(Messenger().post({message:e.msg,type:"success",hideAfter:3,showCloseButton:!0}),window.location.href=a):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),t.removeClass("disabled")}}))}),$(document).on("click",".js-subject-content-add",function(){var t=$(this),e=t.attr("data-url"),a=t.attr("data-href"),o={id:t.attr("data-id"),is_ajax:1,data:[]};$.each($(".manage-subject"),function(){var e=$(this),t=e.find(".related-list li"),a=e.find(".name").val(),s=e.find(".name").attr("data-id"),i=[];0<t.length&&($.each(t,function(){var e=$(this);i.push(e.attr("aid"))}),o.data.push({id:s,name:a,aid:i}))}),t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:e,data:o,dataType:"json",async:!0,success:function(e){"1"==e.result?(Messenger().post({message:e.msg,type:"success",hideAfter:3,showCloseButton:!0}),window.location.href=a):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),t.removeClass("disabled")}}))}),$(document).on("click",".js-save-sort-num",function(){var t=$(this),a={id:t.attr("data-id"),is_ajax:1,data:[]},e=$(".js-sort-num");$.each(e,function(){var e=$(this);a.data.push({id:e.attr("data-id"),sort_num:e.val()})}),t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:"/article_channel/editSort",data:a,dataType:"json",async:!0,success:function(e){"1"==e.result?(Messenger().post({message:e.msg,type:"success",hideAfter:3,showCloseButton:!0}),location.reload()):Messenger().post({message:e.msg,type:"error",hideAfter:3,showCloseButton:!0}),t.removeClass("disabled")}}))}),$(document).on("click",".js-article-channel-ul li,.js-article-collection-ul li,.js-article-sponsor-ul li",function(){var e=$(this),t=(e.parent("ul"),e.parents("ul").attr("data-num")),a=e.parents("ul").find("li.active").length;e.hasClass("active")?e.removeClass("active"):a<t&&e.addClass("active")}),$(document).on("click",".js-sorting",function(){var e=$(this),t=window.location.search,a=window.location.href.replace(t,"")+"?sort="+e.attr("data-sort")+"&field="+e.attr("data-field");window.location.href=a});var getVideoList=function(s,e){$.ajax({type:"post",url:"/video/get_video_list",data:{page:s,k:$("#searchHeardVideo").val()},dataType:"json",async:!0,success:function(e){if(1==e.result){var a="",t=0;$.each(e.data,function(e,t){a+='<li data-id="'+t.id+'"><a>'+interceptionString(t.title)+'</a><input type="radio" class="custom" name="search-video"><img class="history-img"  src="'+t.cover+'" data-videourl="'+t.fhd_link+'"></li>'}),1==s&&(0==e.data.length&&alert(e.msg),$(".search-video-ul").empty()),keyword==$("#searchHeardVideo").val()?($(".search-video-ul").append(a),t=parseInt(s)+1):(keyword=$("#searchHeardVideo").val(),$(".search-video-ul").empty().append(a),t=1),$(".search-img-info").hide(),$(".js-get-more-search-video").attr("data-page",t+""),$(".js-get-more-search-video").removeClass("hide")}else 1==s&&(alert(e.msg),$(".search-img-ul").empty())}})};$(document).on("click",".js-open-video-modal",function(){var e=$(this).attr("data-type");if("feedAd"===e&&$("#img_urls").attr("data-imgid"))return Messenger().post({message:"图片和小视频不能同时发布",type:"error",showCloseButton:!0}),!1;if(0<$(".js-moment-upload-img li").length)return Messenger().post({message:"图片和小视频不能同时发布",type:"error",showCloseButton:!0}),!1;dialogBox("searchImgModal","搜索视频",'<div class="search-img-box history-img-box"><a href="/video/add" class="btn  btn-success pull-left" style="margin-top: 10px;" target="_blank">添加视频</a>&nbsp;&nbsp;<input type="text" id="searchHeardVideo" placeholder="视频关键字"><span class="input-group-addon js-search-video" data-page="1"><i class="fa fa-search"></i></span></div><ul class="search-img-ul search-video-ul"></ul><div class="search-img-info">搜索的结果会在这里显示</div><a class="pull-right js-get-more-search-video search-img-more hide" data-page="1">获取更多</a>','<button class="btn btn-primary js-determine-choose-video">确定</button>'),"station"==e&&(choice_video.type="station"),0<$("#admin-moment-add-box").length?(getMomentVideoList(1),$("#searchHeardVideo").remove(),$(".js-search-video").addClass("hide")):getVideoList(1)}),$("body").on("keypress","#searchHeardVideo",function(e){"13"==e.keyCode&&getVideoList(1)}),$("body").on("click",".js-search-video",function(){getVideoList(1)}),$("body").on("click",".js-get-more-search-video",function(){var e=$(this);getVideoList(e.attr("data-page"))});var choice_video={type:""};$("body").on("click",".js-determine-choose-video",function(){var e=$('input:radio[name="search-video"]:checked'),t=e.next().attr("src"),a=e.parents("li").attr("data-id"),s=e.next().attr("data-videourl");if("station"==choice_video.type){if(""==t)return Messenger().post({message:"此视频封面图为空，请更换视频",type:"error",showCloseButton:!0}),!1;video_pic=t;var i="<video src="+s+" poster="+video_pic+' controls="controls" width="100%">您目前设备暂不支持播放</video>';UE.getEditor("myEditor").execCommand("insertHtml",i),$("#searchImgModal").modal("hide")}else video_pic=t,video_id=a,$(".first-figure-video").addClass("hide"),$(".article-video-pic").removeClass("hide").attr("data-vid",video_id),$(".article-video-pic img").attr("src",video_pic),$("#searchImgModal").modal("hide"),0<$("#admin-moment-add-box").length&&$("#moment-upload-img").attr("type","")}),$(document).on("click",".js-add-content-modal",function(){contentManage()}),$(document).on("click",".js-content-box-btn",function(){$(this);var a=[],e=$(".related-box-ctt ul li");$.each(e,function(e){var t=$(this);a[e]=t.attr("aid")}),0<a.length&&$.ajax({type:"post",url:"/article/addArticleRelation",data:{aid:a,relation_type:$("#relation_type").val(),relation_id:$("#relation_id").val()},dataType:"json",async:!0,success:function(e){1==e.result?(Messenger().post({message:e.msg,type:"success",showCloseButton:!0}),location.reload()):Messenger().post({message:e.msg,type:"error",showCloseButton:!0})}})}),$(document).on("click",".js-remove-article-relation",function(){var e=$(this);confirm("确定要移除此文章!")&&$.ajax({type:"post",url:"/article/removeArticleRelation",data:{aid:e.attr("aid"),relation_type:$("#relation_type").val(),relation_id:$("#relation_id").val()},dataType:"json",async:!0,success:function(e){1==e.result?(Messenger().post({message:e.msg,type:"success",showCloseButton:!0}),location.reload()):Messenger().post({message:e.msg,type:"error",showCloseButton:!0})}})}),$(document).on("click",".js-edit-app-promotion",function(){var t=$(this),e=function(){t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:"/app_promotion/updateAppPromotionStatus ",data:{id:t.attr("data-id"),status:t.attr("data-status")},dataType:"json",async:!0,success:function(e){location.reload(),t.removeClass("disabled")}}))};"2"==t.attr("data-status")?confirm("确定要删除吗？")&&e():e()}),$(document).on("click",".js-add-app-promotion-form,.js-edit-app-promotion-form",function(){var t=$(this),e="add"==t.attr("data-type")?"/app_promotion/addAppPromotion":"/app_promotion/updateAppPromotion",a={id:t.attr("data-id"),title:$("#title").val(),page:$("#page").val(),start_position:$("#start_position").val(),start_dateline:$("#start_dateline").val(),end_dateline:$("#end_dateline").val(),url:$("#url").val(),pic:$("#pic").attr("src"),pic1:$("#pic1").attr("src"),scroll_type:$('input:radio[name="scroll_type"]:checked').val(),label:$("#label").val(),status:"1"};t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({type:"post",url:e,data:a,dataType:"json",async:!0,success:function(e){e.success?(Messenger().post({message:e.data.message,type:"success",showCloseButton:!0}),window.location.href="/app_promotion/index"):Messenger().post({message:e.error.message,type:"error",showCloseButton:!0}),t.removeClass("disabled")}}))}),$("body").on("change","#promotion-pic,#promotion-pic1",function(e){var t=$(this),a=$("#"+t.attr("data-type"));UploadFile("/tool/imageUpload/ad",t.attr("id"),function(e){e.success?a.attr("src",e.data.url):Messenger().post({message:e.data.message,type:"error",showCloseButton:!0})})}),$(document).delegate(".js-zt-btn","click",function(){var i=$(this);$(".article-zt-btn-wrap").length?$.ajax({type:"post",url:"/article_subject/getAllByKeyword",data:[],dataType:"json",async:!0,success:function(e){if(e.success){for(var t="",a=0;a<e.data.length;a++)t+='<li class="js-zt-info" data-id="'+e.data[a].id+'" data-href="'+e.data[a].special_url+'">'+e.data[a].name+"</li>";var s='<ul class="article-zt-list-wrap">'+t+"</ul>";i.parents(".article-zt-btn-wrap").append(s)}},error:function(e){}}):$(".article-zt-list-wrap").remove()}),$(document).on("click",".js-zt-info",function(){var e=$(this),t='<a href="'+e.attr("data-href")+'" target="_blank">'+e.text()+"</a>";UE.getEditor("myEditor").execCommand("insertHtml",t),$(".article-zt-list-wrap").remove()});var remarkTimer=null;function formatTopDatetime(e){var t,a=300-(t=e%300),s=parseInt(e)+parseInt(a),i=function(e){return e<10?"0"+e:e},o=new Date(1e3*s),r=o.getFullYear(),n=o.getMonth()+1,l=o.getDate(),c=o.getHours(),d=o.getMinutes();return 0<(t=d%5)&&(d+=5-t),59<d&&(c+=d/60,d%=60),23<c&&(l+=1,c%=24),r+"-"+i(n)+"-"+i(l)+" "+i(c)+":"+i(d)}function feed_top(){var e={aid:$(".js-top-sure").attr("data-aid"),start_time:$(".top-start-time").val(),end_time:$(".top-end-time").val()};$.ajax({type:"post",url:"/article/feed_top_handle",data:e,dataType:"json",async:!0,success:function(e){1==e.result?Messenger().post({message:e.msg,type:"success",showCloseButton:!0}):Messenger().post({message:e.msg,type:"error",showCloseButton:!0})},error:function(e){Messenger().post({message:e.msg,type:"error",showCloseButton:!0})}}),$("#topModal").modal("hide")}function makeDateTimePicker(e){var t=$("#minDateTime").val(),s=$(e);$("#dtBox").DateTimePicker({isInline:!0,mode:"datetime",minuteInterval:5,minDateTime:t,dateTimeFormat:"yyyy-MM-dd HH:mm",shortMonthNames:["01","02","03","04","05","06","07","08","09","10","11","12"],inputElement:s,buttonsToDisplay:[],showHeader:!1,readonlyInputs:!1,setValueInTextboxOnEveryClick:!0,settingValueOfElement:function(e,t,a){s.html(e)}}),$(".dtpicker-compValue").css({"margin-left":"-5px"})}$(document).on("mouseenter",".js-article-author",function(){clearTimeout(remarkTimer);var e=$(this),t=e.parents(".active-list-box").find(".article-to-audit-wrap"),a=e.parents(".active-list-box").attr("aid");$(".article-to-audit-wrap").addClass("hide"),$.ajax({type:"post",url:"/article/article_author_stat",data:{aid:a},dataType:"json",async:!0,success:function(e){e.success&&(t.empty().append(e.data),t.removeClass("hide"))}})}),$(document).on("mouseleave",".js-article-author",function(){clearTimeout(remarkTimer);var e=$(this);remarkTimer=setTimeout(function(){e.parents(".active-list-box").find(".article-to-audit-wrap").addClass("hide")},200)}),$(document).on("mouseenter",".article-to-audit-wrap",function(){clearTimeout(remarkTimer),$(this).removeClass("hide")}),$(document).on("mouseleave",".article-to-audit-wrap",function(){clearTimeout(remarkTimer);var e=$(this);remarkTimer=setTimeout(function(){e.addClass("hide")},200)}),$(document).on("click",".js-remark-icon",function(){var e=$(this),t=e.parents(".article-author-tg-info").find("#author-id").attr("data-uid"),a=e.prev($(".js-remark-wrap")).html();dialogBox("remarkWrap","备注",""==a?'<textarea type="text" class="alert-remark-text"></textarea>':'<textarea type="text" class="alert-remark-text">'+a+"</textarea>",'<button class="btn btn-primary js-remark-sure" data-uid="'+t+'">确定</button>')}),$(document).on("click",".js-remark-sure",function(){var e=$(this),t={uid:e.attr("data-uid"),remark:e.parents("#remarkWrap").find(".alert-remark-text").val(),huxiu_hash_code:huxiu_hash_code};$(".article-to-audit-wrap").addClass("hide"),$.ajax({type:"post",url:"/permission/update_user_remark",data:t,dataType:"json",async:!0,success:function(e){e.success?0<$("#remarkWrap").length&&($("#remarkWrap").remove(),$(".modal-backdrop").remove()):Messenger().post({message:e.error,type:"error",showCloseButton:!0})}})}),$(document).on("click",".js-commonColumnLiDelete",function(){$(this).parent("li").remove()}),$(document).on("change",".js-commonColumn-option",function(){var e=$(this),t=e.attr("data-num"),a=e.next(".commonColumnBox").find("li.active").length,s=$(".js-commonColumn-option").find("option:selected").attr("data-id");if(collection=[],collection_ids=$(".js-commonColumn-option").next(".commonColumnBox").find("li.active span"),$.each(collection_ids,function(e){var t=$(this);collection[e]=t.attr("data-collection_id")}),0<collection.length&&0<=$.inArray(s,collection))return!1;if(a<t&&0!=s){var i='<li class="active"><span data-collection_id="'+s+'">'+e.val()+'</span><p class="commonColumnLiDelete js-commonColumnLiDelete"></p></li>';$(".commonColumn .commonColumnBox").append(i)}else t<=a&&Messenger().post({message:"通用专栏选择上限5个哦",type:"error",showCloseButton:!0})}),$(document).on("click",".feed-top-modal",function(){var e=$(this),t=e.attr("aid"),a="置顶普通文章";"collection"!=e.attr("relation_type")&&"column"!=e.attr("relation_type")||(a="置顶专栏文章");var s=e.attr("publish-time"),i=formatTopDatetime(s),o=formatTopDatetime(parseInt(s)+7200);mixDatetimeHtml='<input type="hidden" id="minDateTime" value="'+i+'"/>',remarkBtnWrap='<button class="btn btn-success js-top-sure" data-aid="'+t+'" aria-hidden="true">确定</button>',remarkText=mixDatetimeHtml+'<p>开始时间: <input type="text" class="top-start-time" value="'+i+'"></p><p>结束时间: <input type="text" class="top-end-time" value="'+o+'"></p><div id="dtBox"></div>',dialogBox("topModal",a,remarkText,remarkBtnWrap)}),$(document).on("click",".top-start-time",function(){makeDateTimePicker(".top-start-time")}),$(document).on("click",".top-end-time",function(){makeDateTimePicker(".top-end-time")}),$(document).delegate(".js-top-sure","click",function(){var t=$(".top-start-time").val(),s=$(".top-end-time").val(),e={start_time:t,end_time:s};$.ajax({type:"post",url:"/article/checkTopTime",data:e,dataType:"json",async:!0,success:function(e){if(1==e.result)if(e.data.confict&&0<e.data.confict.length){var a="检测置顶时间冲突\n";$.each(e.data.confict,function(e,t){a+=t.name+"置顶时间: "+t.startTime+" - "+t.endTime+"\n"}),a+="当前置顶时间: "+t+" - "+s+"\n",a+="是否继续设置当前置顶时间?\n",confirm(a)&&feed_top()}else feed_top();else alert(e.msg)},error:function(e){Messenger().post({message:e.msg,type:"error",showCloseButton:!0})}})}),$(document).delegate("#feed_top_confirm","click",function(){feed_top()}),0<$("#columnPerson").length&&($("#columnPerson").select2({placeholder:"",multiple:!0,maximumSelectionSize:1,query:function(t){$.ajax({type:"post",url:"/article/search_author?keyword="+t.term+"&huxiu_hash_code="+huxiu_hash_code,dataType:"json",async:!0,success:function(e){var a={results:[]};1==e.result&&$.each(e.data,function(e,t){a.results.push({id:t.id,text:t.title})}),t.callback(a)},error:function(e){console.log(e)}})}}),"undefined"!=typeof article_author_data&&$("#columnPerson").select2("data",article_author_data)),$(document).on("click","#hx-title-check-help",function(){var e=navigator.userAgent.toLowerCase(),t=window.location.protocol;0<e.indexOf("chrome")?(remarkText='<p><a style="font-size:16px;" href="'+t+'//api-alpha.huxiu.com/static/hx_clue_ext_doc.docx" download>下载安装说明文档</a></p><p><a style="font-size:16px;" href="'+t+'//api-alpha.huxiu.com/static/hx_clue_ext_pro.crx" download>下载虎算安装包</a></p>',dialogBox("titleCheckHelp","&nbsp;",remarkText,"")):alert("此功能只支持Chrome浏览器，建议您更换Chrome浏览器")}),$(document).on("click",".js-promotion-active-btn",function(){var t=$(this),i={},e={sorts:i},o=!0;$(".white-list-table tbody tr").each(function(e,t){var a=$(t).attr("data-paid"),s=$(t).find(".sortVal").val();if(!s)return Messenger().post({message:"优先级不能为空",type:"error",hideAfter:3,showCloseButton:!0}),o=!1;i[a]=s}),!t.hasClass("disabled")&&o&&(t.addClass("disabled"),$.ajax({url:"/promotion_active/updatePromotionActiveSort",data:e,dataType:"json",type:"post",success:function(e){console.log(e),e.success?(Messenger().post({message:e.data.message,type:"success",showCloseButton:!0}),window.location.reload()):Messenger().post({message:e.error.message,type:"error",showCloseButton:!0}),t.removeClass("disabled")}}))}),$(document).on("click",".js-promotion-control",function(){var t=$(this),e=t.parents("tr").attr("data-paid"),a=t.attr("data-status");if("del"==t.attr("data-type"))return htmlBox("promotion","确认要删除吗？",'<p style="height:50px;"></p><div class="modal-footer"><div class="btn btn-primary js-promotion-del-sureBtn" data-status="'+a+'" data-id="'+e+'">确定</div></div>'),!1;var s={id:e,status:a};t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({url:"/promotion_active/change",data:s,dataType:"json",type:"post",success:function(e){console.log(e),e.success?(Messenger().post({message:e.data.message,type:"success",showCloseButton:!0}),window.location.reload()):Messenger().post({message:e.error.message,type:"error",showCloseButton:!0}),t.removeClass("disabled")}}))}),$(document).on("click",".js-promotion-del-sureBtn",function(){var t=$(this),e={id:t.attr("data-id"),status:t.attr("data-status")};t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({url:"/promotion_active/change",data:e,dataType:"json",type:"post",success:function(e){console.log(e),e.success?(Messenger().post({message:e.data.message,type:"success",showCloseButton:!0}),window.location.reload()):Messenger().post({message:e.error.message,type:"error",showCloseButton:!0}),t.removeClass("disabled")}}))}),commonComponents.formDataUpImg("js-promotion-active-upImg","/tool/imageUpload/ad"),$(document).on("click",".js-promotion-save",function(){var t=$(this),e=$("[data-require = 'true']"),a=checkRequired(e),s=$("#title").val(),i=$("#start_time").val(),o=$("#end_time").val(),r=$("#js-promotion-active-upImg").attr("data-imgurl"),n=$("#url_path").val(),l=[],c=$(".js-channelIOS").prop("checked"),d=$(".js-channelIOS").val();c&&l.push(d),$(".js-singleLi").each(function(e,t){var a=$(t);if(a.hasClass("active")){var s=a.attr("data-channel");l.push(s)}}),console.log(l);var u=[];if($(".js-userTotal").prop("checked")){var p=$(".js-userTotal").val();u.push(p)}var h=$(".js-userRadioBtn").prop("checked"),m=!1;if($(".js-userClass").each(function(e,t){var a=$(this);if(a.prop("checked")){m=!0;var s=a.val();u.push(s)}}),h&&!m)return Messenger().post({message:"仅限指定用户，下面至少选中一类用户",type:"error",showCloseButton:!0}),!1;console.log(u);var g={name:s,start_time:i,end_time:o,url_path:n,img_path:r,types:u,channels:l},v=t.attr("data-type"),f=t.attr("data-id");"edit"==v&&(g.id=f),a&&(t.hasClass("disabled")||(t.addClass("disabled"),$.ajax({url:"/promotion_active/save",data:g,dataType:"json",type:"post",success:function(e){console.log(e),e.success?(Messenger().post({message:e.data.message,type:"success",showCloseButton:!0}),window.location.href="/promotion_active/index"):Messenger().post({message:e.error.message,type:"error",showCloseButton:!0}),t.removeClass("disabled")}})))}),$(document).on("click",".js-channel-android",function(){var e=$(this);e.prop("checked")?e.parent("li").find(".channel_info .singleLi").addClass("active"):e.parent("li").find(".channel_info .singleLi").removeClass("active")}),$(document).on("click",".js-userClass",function(){var e=$(this).parents(".userClassLi").find("input.userRadio");e.prop("checked")||e.prop("checked",!0)}),$(document).on("click",".js-userTotal",function(){var e=$(this).parents(".userClassBox").find(".js-userClass");$(e).each(function(e,t){$(t).prop("checked")&&$(t).prop("checked",!1)})});